<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kasir Stok Air - Realtime Update</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
body {
font-family: 'Poppins', sans-serif;
background-color: var(--bg-color);
color: var(--text-color);
font-size: 14px;
}
/* CSS Variables for Theme Support */
:root {
/* Default Theme */
--bg-color: #f8fafc;
--text-color: #000000;
--card-bg: #ffffff;
--card-border: #e2e8f0;
--input-bg: #ffffff;
--input-border: #cbd5e1;
--input-text: #000000;
--button-bg: linear-gradient(to right, #134e4a, #000000);
--button-hover: linear-gradient(to right, #0f766e, #000000);
--nav-bg: linear-gradient(to right, #134e4a, #000000);
--header-bg: linear-gradient(to right, #134e4a, #000000);
--modal-bg: #ffffff;
--modal-border: #e2e8f0;
--toast-bg: linear-gradient(to right, #134e4a, #000000);
--toast-success: linear-gradient(to right, #10b981, #059669);
--toast-error: linear-gradient(to right, #ef4444, #dc2626);
--toast-warning: linear-gradient(to right, #f59e0b, #d97706);
--animation-duration: 0.3s;
}
/* Dark Theme */
body.dark-theme {
--bg-color: #1f2937;
--text-color: #f9fafb;
--card-bg: #374151;
--card-border: #4b5563;
--input-bg: #374151;
--input-border: #4b5563;
--input-text: #f9fafb;
--button-bg: linear-gradient(to right, #047857, #065f46);
--button-hover: linear-gradient(to right, #059669, #047857);
--nav-bg: linear-gradient(to right, #047857, #065f46);
--header-bg: linear-gradient(to right, #047857, #065f46);
--modal-bg: #374151;
--modal-border: #4b5563;
--toast-bg: linear-gradient(to right, #047857, #065f46);
--toast-success: linear-gradient(to right, #10b981, #059669);
--toast-error: linear-gradient(to right, #ef4444, #dc2626);
--toast-warning: linear-gradient(to right, #f59e0b, #d97706);
}
/* Light Theme */
body.light-theme {
--bg-color: #ffffff;
--text-color: #111827;
--card-bg: #f9fafb;
--card-border: #e5e7eb;
--input-bg: #ffffff;
--input-border: #d1d5db;
--input-text: #111827;
--button-bg: linear-gradient(to right, #3b82f6, #2563eb);
--button-hover: linear-gradient(to right, #2563eb, #1d4ed8);
--nav-bg: linear-gradient(to right, #3b82f6, #2563eb);
--header-bg: linear-gradient(to right, #3b82f6, #2563eb);
--modal-bg: #ffffff;
--modal-border: #e5e7eb;
--toast-bg: linear-gradient(to right, #3b82f6, #2563eb);
--toast-success: linear-gradient(to right, #10b981, #059669);
--toast-error: linear-gradient(to right, #ef4444, #dc2626);
--toast-warning: linear-gradient(to right, #f59e0b, #d97706);
}
/* PERUBAHAN: Update CSS .content-container */
.content-container {
padding-top: 0px; /* 60px (top-nav) + 50px (horizontal-menu) */
padding-bottom: 70px; /* 70px (bottom-nav) */
min-height: calc(100vh - 180px); /* 100vh - (110px + 70px) */
}
.bottom-nav {
height: 70px;
background: var(--nav-bg);
}
.top-nav {
height: 60px;
background: var(--header-bg);
transition: background 0.3s ease;
}
.thermal-print {
font-family: 'Courier New', monospace;
width: 80mm;
font-size: 12px;
color: #000;
line-height: 1.4;
}
.card {
background: var(--card-bg);
border: 1px solid var(--card-border);
box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
}
.btn-primary {
background: var(--button-bg);
color: white;
transition: all 0.3s ease;
}
.btn-primary:hover {
background: var(--button-hover);
transform: translateY(-2px);
box-shadow: 0 4px 8px rgba(19, 78, 74, 0.3);
}
.input-field {
background: var(--input-bg);
border: 1px solid var(--input-border);
color: var(--input-text);
transition: all 0.2s ease;
}
.input-field:disabled {
background-color: #f3f4f6;
color: #6b7280;
cursor: not-allowed;
}
.input-field:focus {
border-color: #134e4a;
outline: none;
box-shadow: 0 0 0 2px rgba(19, 78, 74, 0.3);
}
.nav-btn.active {
color: #edff00;
}
.nav-btn.active::before {
content: '';
position: absolute;
top: 50%;
left: 50%;
transform: translate(-50%, -50%);
width: 65px;
height: 65px;
background: rgb(10 83 93);
border-radius: 50%;
z-index: -1;
margin: 0px;
border: 1px solid;
}
.cart-item {
background: var(--card-bg);
border: 1px solid var(--card-border);
border-radius: 8px;
padding: 12px;
margin-bottom: 12px;
transition: all 0.2s ease;
position: relative;
overflow: hidden;
}
.cart-item:hover {
transform: translateY(-2px);
box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
border-color: #134e4a;
}
.cart-item-content {
transition: transform 0.3s ease;
}
.cart-delete-btn {
position: absolute;
top: 0;
right: 0;
bottom: 0;
width: 80px;
background: #ef4444;
color: white;
display: flex;
align-items: center;
justify-content: center;
transform: translateX(100%);
transition: transform 0.3s ease;
}
.cart-item.swipe-left .cart-item-content {
transform: translateX(-80px);
}
.cart-item.swipe-left .cart-delete-btn {
transform: translateX(0);
}
.payment-method.active {
background: var(--button-bg);
color: white;
}
.modal-content {
background: var(--modal-bg);
border: 1px solid var(--modal-border);
}
.gradient-text {
background: linear-gradient(to right, #134e4a, #000000);
-webkit-background-clip: text;
background-clip: text;
color: transparent;
}
.gradient-bg {
background: linear-gradient(to right, #134e4a, #000000);
}
.lunas-badge {
background: linear-gradient(to right, #10b981, #059669);
color: white;
padding: 2px 8px;
border-radius: 12px;
font-size: 12px;
font-weight: 600;
}
.disabled-btn {
background: #9ca3af;
color: white;
cursor: not-allowed;
}
/* Card colors */
.card-water {
background: linear-gradient(135deg, #e0f2fe, #bae6fd);
border-left: 4px solid #0284c7;
}
.card-transactions {
background: linear-gradient(135deg, #dcfce7, #bbf7d0);
border-left: 4px solid #16a34a;
}
.card-debts {
background: linear-gradient(135deg, #fef3c7, #fde68a);
border-left: 4px solid #d97706;
}
.card-products {
background: linear-gradient(135deg, #ede9fe, #ddd6fe);
border-left: 4px solid #7e22ce;
}
.card-cash {
background: linear-gradient(135deg, #dbeafe, #bfdbfe);
border-left: 4px solid #3b82f6;
}
/* Product List Style */
.product-list-item {
background: var(--card-bg);
border: 1px solid var(--card-border);
border-radius: 8px;
padding: 16px;
margin-bottom: 12px;
transition: all 0.2s ease;
cursor: pointer;
position: relative;
display: flex;
justify-content: space-between;
align-items: center;
}
.product-list-item:hover {
transform: translateY(-2px);
box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
border-color: #134e4a;
}
.product-list-info {
flex: 1;
}
.product-list-name {
font-weight: 600;
font-size: 16px;
margin-bottom: 4px;
}
.product-list-details {
font-size: 14px;
color: #6b7280;
}
.product-list-price {
font-weight: bold;
color: #134e4a;
font-size: 16px;
}
.product-actions {
display: flex;
gap: 8px;
margin-left: 16px;
}
.cart-badge {
position: absolute;
top: -8px;
right: -8px;
background: #ef4444;
color: white;
border-radius: 50%;
width: 20px;
height: 20px;
display: flex;
align-items: center;
justify-content: center;
font-size: 12px;
font-weight: bold;
animation: pulse 2s infinite;
}
.notification-badge {
position: absolute;
top: -5px;
right: -5px;
background: #ef4444;
color: white;
border-radius: 50%;
width: 16px;
height: 16px;
display: flex;
align-items: center;
justify-content: center;
font-size: 10px;
font-weight: bold;
animation: pulse 2s infinite;
}
/* Receipt styles */
.receipt-container {
width: 100%;
max-width: 400px;
margin: 0 auto;
font-family: 'Courier New', monospace;
font-size: 12px;
line-height: 1.4;
color: #000;
}
.receipt-header {
text-align: center;
margin-bottom: 15px;
padding-bottom: 10px;
border-bottom: 2px dashed #333;
}
.receipt-logo {
width: 60px;
height: 60px;
margin: 0 auto 10px;
background: #134e4a;
border-radius: 50%;
display: flex;
align-items: center;
justify-content: center;
color: white;
font-size: 24px;
overflow: hidden;
}
.receipt-logo img {
width: 100%;
height: 100%;
object-fit: cover;
}
.receipt-title {
font-size: 18px;
font-weight: bold;
margin-bottom: 5px;
color: #134e4a;
}
.receipt-subtitle {
font-size: 11px;
margin-bottom: 3px;
color: #555;
}
.receipt-info {
margin-bottom: 15px;
}
.receipt-row {
display: flex;
justify-content: space-between;
margin-bottom: 5px;
}
.receipt-label {
font-weight: bold;
color: #333;
}
.receipt-value {
color: #000;
}
.receipt-items {
margin-bottom: 15px;
}
.receipt-items-header {
display: flex;
justify-content: space-between;
font-weight: bold;
border-bottom: 1px solid #333;
padding-bottom: 5px;
margin-bottom: 5px;
}
.receipt-item {
display: flex;
justify-content: space-between;
margin-bottom: 5px;
}
.receipt-item-name {
flex: 1;
text-align: left;
}
.receipt-item-qty {
width: 30px;
text-align: center;
}
.receipt-item-price {
width: 70px;
text-align: right;
}
.receipt-item-total {
width: 80px;
text-align: right;
font-weight: bold;
}
.receipt-summary {
margin-bottom: 15px;
border-top: 1px dashed #333;
padding-top: 10px;
}
.receipt-summary-row {
display: flex;
justify-content: space-between;
margin-bottom: 5px;
}
.receipt-total {
font-size: 14px;
font-weight: bold;
border-top: 1px solid #333;
padding-top: 5px;
margin-top: 5px;
}
.receipt-payment {
margin-bottom: 15px;
}
.receipt-footer {
text-align: center;
margin-top: 15px;
padding-top: 10px;
border-top: 2px dashed #333;
font-size: 11px;
color: #555;
}
.receipt-thank {
font-weight: bold;
margin-top: 5px;
color: #134e4a;
}
/* Header color themes */
.header-home {
background: linear-gradient(to right, #134e4a, #000000);
}
.header-products {
background: linear-gradient(to right, #7e22ce, #000000);
}
.header-transaction {
background: linear-gradient(to right, #dc2626, #000000);
}
.header-history {
background: linear-gradient(to right, #2563eb, #000000);
}
.header-water-stock {
background: linear-gradient(to right, #0891b2, #000000);
}
.header-settings {
background: linear-gradient(to right, #4b5563, #000000);
}
.header-customers {
background: linear-gradient(to right, #059669, #000000);
}
.header-expenses {
background: linear-gradient(to right, #d97706, #000000);
}
.header-reports {
background: linear-gradient(to right: #7c3aed, #000000);
}
.header-debts {
background: linear-gradient(to right: #ea580c, #000000);
}
/* Water Tank Visualization */
.water-tank {
position: relative;
width: 100%; /* Diubah dari 200px menjadi 100% sesuai permintaan */
height: 500px;
margin: 0 auto;
border: 4px solid #000;
border-radius: 80px 80px 20px 20px;
overflow: hidden;
background-color: #000;
}
.water-tank-lid {
position: absolute;
top: -20px;
left: 50%;
transform: translateX(-50%);
width: 240px;
height: 40px;
background: linear-gradient(to right, #4b5563, #1f2937);
border-radius: 120px 120px 0 0;
border: 3px solid #000;
z-index: 2;
box-shadow: 0 -5px 10px rgba(0, 0, 0, 0.2);
}
.water-tank-lid::after {
content: '';
position: absolute;
top: 10px;
left: 50%;
transform: translateX(-50%);
width: 60px;
height: 20px;
background: #9ca3af;
border-radius: 30px;
border: 2px solid #000;
}
.water-level {
position: absolute;
bottom: 0;
left: 0;
right: 0;
background: linear-gradient(to top, #0891b2, #67e8f9);
transition: height 1s ease-in-out;
}
.water-wave {
position: absolute;
top: 0;
left: 0;
width: 200%;
height: 20px;
background: rgba(255, 255, 255, 0.3);
border-radius: 50%;
animation: wave 1s linear infinite;
}
@keyframes wave {
0% { transform: translateX(-50%); }
100% { transform: translateX(0%); }
}
.water-level-indicator {
position: absolute;
top: 30px;
left: 0;
right: 0;
text-align: center;
font-weight: bold;
font-size:large;
color: #fff;
z-index: 10;
}
/* Notification Panel */
.notification-panel {
position: fixed;
top: 60px;
right: 20px;
width: 350px;
max-height: 400px;
background: white;
border-radius: 8px;
box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
z-index: 100;
overflow: hidden;
display: none;
animation: slideDown 0.3s ease;
}
.notification-panel.show {
display: block;
}
.notification-header {
padding: 12px 16px;
background: linear-gradient(to right, #134e4a, #000000);
color: white;
font-weight: 600;
display: flex;
justify-content: space-between;
align-items: center;
}
.notification-clear {
font-size: 12px;
cursor: pointer;
opacity: 0.8;
transition: opacity 0.2s;
}
.notification-clear:hover {
opacity: 1;
}
.notification-list {
max-height: 340px;
overflow-y: auto;
}
.notification-item {
padding: 12px 16px;
border-bottom: 1px solid #f1f5f9;
transition: background-color 0.2s;
cursor: pointer;
}
.notification-item:hover {
background-color: #f8fafc;
}
.notification-item:last-child {
border-bottom: none;
}
.notification-date {
font-size: 12px;
color: #6b7280;
margin-bottom: 4px;
}
.notification-text {
font-size: 14px;
color: #1f2937;
}
.notification-status {
font-size: 11px;
margin-top: 4px;
padding: 2px 6px;
border-radius: 10px;
display: inline-block;
}
.notification-status.enable {
background-color: #d1fae5;
color: #065f46;
}
.notification-status.disable {
background-color: #fee2e2;
color: #991b1b;
}
.notification-empty {
padding: 24px 16px;
text-align: center;
color: #6b7280;
font-size: 14px;
}
/* Change calculation display */
.change-calculation {
margin-top: 12px;
padding: 12px;
background: #f0fdf4;
border: 1px solid #bbf7d0;
border-radius: 8px;
}
.change-amount {
font-size: 18px;
font-weight: bold;
color: #166534;
}
.short-amount {
font-size: 18px;
font-weight: bold;
color: #dc2626;
}
.exact-amount {
font-size: 18px;
font-weight: bold;
color: #059669;
}
/* Cart Panel */
.cart-panel {
position: fixed;
top: 60px;
right: 20px;
width: 350px;
max-height: 500px;
background: white;
border-radius: 8px;
box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
z-index: 100;
overflow: hidden;
display: none;
animation: slideDown 0.3s ease;
}
.cart-panel.show {
display: block;
}
.cart-header {
padding: 12px 16px;
background: linear-gradient(to right, #134e4a, #000000);
color: white;
font-weight: 600;
display: flex;
justify-content: space-between;
align-items: center;
}
.cart-list {
max-height: 340px;
overflow-y: auto;
}
.cart-empty {
padding: 24px 16px;
text-align: center;
color: #6b7280;
font-size: 14px;
}
.cart-footer {
padding: 16px;
border-top: 1px solid #f1f5f9;
}
.cart-total {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 12px;
font-weight: bold;
font-size: 16px;
}
/* Horizontal Menu Bar */
.horizontal-menu {
position: fixed;
top: 60px;
left: 0;
right: 0;
height: 50px;
background: white;
border-bottom: 1px solid #e2e8f0;
display: flex;
justify-content: center;
align-items: center;
z-index: 5;
box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
overflow-x: auto;
scrollbar-width: none; /* Firefox */
-ms-overflow-style: none; /* IE and Edge */
}
.horizontal-menu::-webkit-scrollbar {
display: none; /* Chrome, Safari, Opera */
}
.horizontal-menu-items {
display: flex;
gap: 16px;
white-space: nowrap;
padding: 0 16px;
}
.horizontal-menu-item {
padding: 6px 12px;
border-radius: 16px;
font-size: 12px;
font-weight: 500;
cursor: pointer;
transition: all 0.2s ease;
display: flex;
align-items: center;
gap: 6px;
flex-shrink: 0;
}
.horizontal-menu-item.customers {
background: rgba(5, 150, 105, 0.1);
color: #059669;
}
.horizontal-menu-item.debts {
background: rgba(234, 88, 12, 0.1);
color: #ea580c;
}
.horizontal-menu-item.expenses {
background: rgba(217, 119, 6, 0.1);
color: #d97706;
}
.horizontal-menu-item.reports {
background: rgba(124, 58, 237, 0.1);
color: #7c3aed;
}
.horizontal-menu-item:hover {
transform: translateY(-2px);
box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}
/* Local Storage Toggle */
.toggle-switch {
position: relative;
display: inline-block;
width: 50px;
height: 24px;
}
.toggle-switch input {
opacity: 0;
width: 0;
height: 0;
}
.slider {
position: absolute;
cursor: pointer;
top: 0;
left: 0;
right: 0;
bottom: 0;
background-color: #ccc;
transition: .4s;
border-radius: 24px;
}
.slider:before {
position: absolute;
content: "";
height: 16px;
width: 16px;
left: 4px;
bottom: 4px;
background-color: white;
transition: .4s;
border-radius: 50%;
}
input:checked + .slider {
background-color: #134e4a;
}
input:checked + .slider:before {
transform: translateX(26px);
}
/* Receipt action buttons */
.receipt-actions {
display: flex;
justify-content: center;
gap: 16px;
margin-top: 16px;
}
.receipt-action-btn {
width: 50px;
height: 50px;
border-radius: 50%;
display: flex;
align-items: center;
justify-content: center;
font-size: 20px;
transition: all 0.3s ease;
cursor: pointer;
}
.receipt-action-btn:hover {
transform: scale(1.1);
}
.receipt-print-btn {
background: linear-gradient(to right, #134e4a, #000000);
color: white;
}
.receipt-download-btn {
background: linear-gradient(to right, #059669, #047857);
color: white;
}
.receipt-close-btn {
background: linear-gradient(to right, #ef4444, #dc2626);
color: white;
}
/* Product type selector */
.product-type-selector {
position: relative;
}
.product-type-dropdown {
position: absolute;
top: 100%;
left: 0;
right: 0;
background: white;
border: 1px solid #cbd5e1;
border-radius: 8px;
box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
z-index: 10;
max-height: 200px;
overflow-y: auto;
display: none;
}
.product-type-dropdown.show {
display: block;
}
.product-type-option {
padding: 8px 12px;
cursor: pointer;
transition: background-color 0.2s;
}
.product-type-option:hover {
background-color: #f3f4f6;
}
.product-type-option.selected {
background-color: #134e4a;
color: white;
}
.add-new-type {
border-top: 1px solid #e5e7eb;
padding: 8px 12px;
display: flex;
align-items: center;
gap: 8px;
color: #134e4a;
font-weight: 500;
}
.add-new-type:hover {
background-color: #f0fdf4;
}
/* Hidden reload container */
.reload-container {
position: fixed;
top: -100px;
left: -100px;
width: 1px;
height: 1px;
overflow: hidden;
opacity: 0;
}
/* Water Stock History */
.water-stock-history {
margin-top: 20px;
}
.history-item {
display: flex;
justify-content: space-between;
align-items: center;
padding: 12px;
border-bottom: 1px solid #e2e8f0;
}
.history-item:last-child {
border-bottom: none;
}
.history-date {
font-size: 12px;
color: #6b7280;
}
.history-amount {
font-weight: bold;
color: #134e4a;
}
.history-cost {
font-size: 12px;
color: #6b7280;
}
/* Page Loading Indicator */
.page-loading {
position: fixed;
top: 0;
left: 0;
right: 0;
height: 3px;
background: linear-gradient(to right, #134e4a, #000000);
z-index: 9999;
transition: width 0.3s ease;
}
/* Real-time Update Indicator */
.realtime-indicator {
position: fixed;
bottom: 80px;
right: 20px;
background: rgba(19, 78, 74, 0.9);
color: white;
padding: 8px 12px;
border-radius: 20px;
font-size: 12px;
display: flex;
align-items: center;
gap: 6px;
z-index: 100;
opacity: 0;
transition: opacity 0.3s ease;
}
.realtime-indicator.show {
opacity: 1;
}
.realtime-indicator i {
animation: spin 1s linear infinite;
}
/* Theme Selector Styles */
.theme-selector {
display: flex;
gap: 12px;
margin-bottom: 16px;
}
.theme-option {
flex: 1;
padding: 12px;
border-radius: 8px;
border: 2px solid transparent;
cursor: pointer;
text-align: center;
transition: all 0.2s ease;
}
.theme-option.active {
border-color: #134e4a;
box-shadow: 0 0 0 2px rgba(19, 78, 74, 0.2);
}
.theme-option:hover {
transform: translateY(-2px);
box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}
.theme-default {
background: linear-gradient(to right, #134e4a, #000000);
color: white;
}
.theme-dark {
background: linear-gradient(to right, #047857, #065f46);
color: white;
}
.theme-light {
background: linear-gradient(to right, #3b82f6, #2563eb);
color: white;
}
.theme-icon {
font-size: 24px;
margin-bottom: 4px;
}
.theme-name {
font-size: 12px;
font-weight: 500;
}
/* Cart quantity input improvements */
.cart-quantity-input {
width: 60px !important;
text-align: center;
font-weight: bold;
font-size: 16px;
padding: 8px 4px;
border: 2px solid #134e4a;
border-radius: 6px;
color: #134e4a;
}
.cart-quantity-input:focus {
outline: none;
box-shadow: 0 0 0 2px rgba(19, 78, 74, 0.3);
}
/* Customer autocomplete improvements */
#customer-suggestions {
z-index: 50;
box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
}
#customer-suggestions div:hover {
background-color: rgba(19, 78, 74, 0.1);
}
/* Cart item improvements */
.cart-product-name {
font-weight: 600;
font-size: 16px;
margin-bottom: 8px;
}
.cart-product-details {
display: flex;
justify-content: space-between;
align-items: center;
}
.cart-product-price {
font-weight: bold;
color: #134e4a;
font-size: 16px;
}
/* Optimized card animations */
.card-animate {
animation: fadeIn var(--animation-duration) ease forwards;
}
/* Loading Overlay Styles */
.initial-loading-overlay {
position: fixed;
top: 0;
left: 0;
right: 0;
bottom: 0;
background: linear-gradient(135deg, #134e4a 0%, #000000 100%);
display: flex;
flex-direction: column;
justify-content: center;
align-items: center;
z-index: 9999;
transition: opacity 0.5s ease, visibility 0.5s ease;
}
.initial-loading-overlay.hidden {
opacity: 0;
visibility: hidden;
}
.loading-content {
text-align: center;
color: white;
}
.loading-logo {
width: 80px;
height: 80px;
background: white;
border-radius: 50%;
display: flex;
align-items: center;
justify-content: center;
margin: 0 auto 30px;
box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
animation: pulse 2s infinite;
}
.loading-logo i {
font-size: 40px;
color: #134e4a;
}
.loading-logo img {
width: 100%;
height: 100%;
object-fit: cover;
}

.loading-spinner {
    width: 100px;
    height: 100px;
    border: 4px solid rgba(255, 255, 255, 0.2);
    border-radius: 50%;
    border-top-color: white;
    animation: spin 1s linear infinite;
    margin: -120px auto 20px;
}
.loading-text {
font-size: 18px;
font-weight: 500;
margin-bottom: 10px;
}
.loading-subtext {
font-size: 14px;
opacity: 0.8;
}
.loading-progress {
width: 200px;
height: 4px;
background: rgba(255, 255, 255, 0.2);
border-radius: 2px;
margin: 20px auto 0;
overflow: hidden;
}
.loading-progress-bar {
height: 100%;
background: white;
border-radius: 2px;
width: 0%;
animation: loadingProgress 2s ease-in-out infinite;
}
@keyframes loadingProgress {
0% { width: 0%; }
50% { width: 70%; }
100% { width: 100%; }
}
/* Main content hidden during initial load */
.main-content-wrapper {
opacity: 0;
transition: opacity 0.5s ease;
}
.main-content-wrapper.visible {
opacity: 1;
}
/* Reduced motion support */
@media (prefers-reduced-motion: reduce) {
*, *::before, *::after {
animation-duration: 0.01ms !important;
animation-iteration-count: 1 !important;
transition-duration: 0.01ms !important;
}
}
/* Toast Notification Styles - Updated */
.toast-container {
position: fixed;
z-index: 1000;
pointer-events: none;
display: flex;
flex-direction: column;
gap: 10px;
}
.toast-container.top-right {
top: 80px;
right: 20px;
align-items: flex-end;
}
.toast-container.top-left {
top: 80px;
left: 20px;
align-items: flex-start;
}
.toast-container.bottom-right {
bottom: 80px;
right: 20px;
align-items: flex-end;
}
.toast-container.bottom-left {
bottom: 80px;
left: 20px;
align-items: flex-start;
}
.toast-container.top-center {
top: 80px;
left: 50%;
transform: translateX(-50%);
align-items: center;
}
.toast {
position: relative;
min-width: 280px;
max-width: 400px;
padding: 16px 20px;
border-radius: 12px;
background: var(--toast-bg);
color: white;
box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
display: flex;
align-items: center;
gap: 12px;
pointer-events: auto;
transform: translateY(-20px);
opacity: 0;
transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
overflow: hidden;
margin-bottom: 10px;
}
.toast.show {
transform: translateY(0);
opacity: 1;
}
.toast.success {
background: var(--toast-success);
}
.toast.error {
background: var(--toast-error);
}
.toast.warning {
background: var(--toast-warning);
}
.toast-icon {
font-size: 20px;
flex-shrink: 0;
}
.toast-content {
flex: 1;
min-width: 0;
}
.toast-message {
font-weight: 500;
margin: 0;
white-space: normal;
word-wrap: break-word;
}
.toast-close {
position: absolute;
top: 8px;
right: 8px;
background: rgba(255, 255, 255, 0.2);
border: none;
color: white;
width: 24px;
height: 24px;
border-radius: 50%;
display: flex;
align-items: center;
justify-content: center;
cursor: pointer;
opacity: 0.7;
transition: opacity 0.2s, background 0.2s;
flex-shrink: 0;
}
.toast-close:hover {
opacity: 1;
}
.toast-close:hover {
background: rgba(255, 255, 255, 0.3);
}
.toast-progress {
position: absolute;
bottom: 0;
left: 0;
height: 3px;
background: rgba(255, 255, 255, 0.3);
border-radius: 0 0 12px 12px;
animation: toastProgress 3s linear forwards;
}
@keyframes toastProgress {
from { width: 100%; }
to { width: 0%; }
}
/* Modern Toast Styles */
.toast.modern {
border-radius: 16px;
backdrop-filter: blur(10px);
-webkit-backdrop-filter: blur(10px);
}
.toast.modern::before {
content: '';
position: absolute;
top: 0;
left: 0;
right: 0;
bottom: 0;
background: linear-gradient(135deg, rgba(255, 255, 255, 0.2) 0%, rgba(255, 255, 255, 0) 100%);
border-radius: inherit;
}
/* Minimal Toast Styles */
.toast.minimal {
border-radius: 8px;
box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
padding: 12px 16px;
}
.toast.minimal .toast-icon {
font-size: 18px;
}
/* Card Toast Styles */
.toast.card {
border-radius: 12px;
background: white;
color: #333;
box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
}
.toast.card.success {
border-left: 4px solid var(--toast-success);
}
.toast.card.error {
border-left: 4px solid var(--toast-error);
}
.toast.card.warning {
border-left: 4px solid var(--toast-warning);
}
.toast.card .toast-icon {
color: var(--toast-bg);
}
.toast.card .toast-close {
color: #666;
background: #f0f0f0;
}
.toast.card .toast-close:hover {
background: #e0e0e0;
}
@keyframes fadeIn {
from { opacity: 0; transform: translateY(10px); }
to { opacity: 1; transform: translateY(0); }
}
@keyframes slideDown {
from { opacity: 0; transform: translateY(-10px); }
to { opacity: 1; transform: translateY(0); }
}
@keyframes slideUp {
from { opacity: 0; transform: translateY(10px); }
to { opacity: 1; transform: translateY(0); }
}
@keyframes spin {
0% { transform: rotate(0deg); }
100% { transform: rotate(360deg); }
}
@keyframes pulse {
0% { transform: scale(1); }
50% { transform: scale(1.05); }
100% { transform: scale(1); }
}
</style>
</head>
<body>
<!-- Initial Loading Overlay -->
<div id="initial-loading-overlay" class="initial-loading-overlay">
<div class="loading-content">
<div class="loading-logo">
<i id="loading-logo-icon" class="fas fa-tint"></i>
<img id="loading-logo-img" class="w-full h-full object-cover hidden" alt="Logo" crossorigin="anonymous">
</div>
<div class="loading-spinner"></div>
<div class="loading-text">YOUSHE</div>
<div class="loading-progress">
<div class="loading-progress-bar"></div>
</div>
</div>
</div>
<!-- Main Content Wrapper -->
<div id="main-content-wrapper" class="main-content-wrapper">
<!-- Loading Overlay -->
<div id="loading-overlay" class="loading-overlay">
<div class="flex flex-col items-center">
<div class="loading-spinner"></div>
<div class="loading-text">Memuat data...</div>
</div>
</div>
<!-- Page Loading Indicator -->
<div id="page-loading" class="page-loading" style="width: 0%"></div>
<!-- Real-time Update Indicator -->
<div id="realtime-indicator" class="realtime-indicator">
<i class="fas fa-sync-alt"></i>
<span>Memperbarui data...</span>
</div>
<!-- Hidden container for background reload -->
<div class="reload-container">
<iframe id="reload-frame" width="1" height="1"></iframe>
</div>
<!-- Top Navigation -->
<div id="top-nav" class="fixed top-0 left-0 right-0 text-white z-10 top-nav flex items-center justify-between px-4 shadow-md header-home">
<div class="flex items-center space-x-3">
<div id="logo-container" class="w-10 h-10 bg-white rounded-full flex items-center justify-center overflow-hidden">
<i id="logo-icon" class="fas fa-tint text-[#134e4a]"></i>
<img id="business-logo" class="w-full h-full object-cover hidden" alt="Logo" crossorigin="anonymous">
</div>
<div>
<h1 id="business-name" class="font-bold text-lg">YOUSHE</h1>
<p id="business-address" class="text-xs opacity-80">Jl. Indraprasta</p>
</div>
</div>
<div class="flex items-center space-x-4">
<div class="relative">
<button onclick="toggleCartPanel()" class="p-2 rounded-full hover:bg-black hover:bg-opacity-20 transition">
<i class="fas fa-shopping-cart text-xl"></i>
</button>
<span id="cart-badge" class="cart-badge hidden">0</span>
</div>
<div class="relative">
<button onclick="toggleNotificationPanel()" class="p-2 rounded-full hover:bg-black hover:bg-opacity-20 transition">
<i class="fas fa-bell text-xl"></i>
</button>
<span id="notification-badge" class="notification-badge hidden">0</span>
</div>
<button onclick="showPage('settings')" class="p-2 rounded-full hover:bg-black hover:bg-opacity-20 transition">
<i class="fas fa-cog text-xl"></i>
</button>
</div>
</div>
<!-- Horizontal Menu Bar -->
<div class="horizontal-menu">
<div class="horizontal-menu-items">
<div class="horizontal-menu-item customers" onclick="showPage('customers')">
<i class="fas fa-users"></i>
<span>Pelanggan</span>
</div>
<div class="horizontal-menu-item debts" onclick="showPage('debts')">
<i class="fas fa-file-invoice-dollar"></i>
<span>Kas Bon</span>
</div>
<div class="horizontal-menu-item expenses" onclick="showPage('expenses')">
<i class="fas fa-money-bill-wave"></i>
<span>Keuangan</span>
</div>
<div class="horizontal-menu-item reports" onclick="showPage('reports')">
<i class="fas fa-chart-bar"></i>
<span>Laporan</span>
</div>
</div>
</div>
<!-- Notification Panel -->
<div id="notification-panel" class="notification-panel">
<div class="notification-header">
<span>Notifikasi</span>
<span class="notification-clear" onclick="clearNotifications()">Hapus Semua</span>
</div>
<div id="notification-list" class="notification-list">
<div class="notification-empty">Tidak ada notifikasi</div>
</div>
</div>
<!-- Cart Panel -->
<div id="cart-panel" class="cart-panel">
<div class="cart-header">
<span>Keranjang Belanja</span>
<span class="notification-clear" onclick="clearCart()">Kosongkan</span>
</div>
<div id="cart-list" class="cart-list">
<div class="cart-empty">Keranjang belanja kosong</div>
</div>
<div class="cart-footer">
<div class="cart-total">
<span>Total:</span>
<span>Rp <span id="cart-panel-total">0</span></span>
</div>
<button onclick="goToCheckout()" class="w-full btn-primary py-2 rounded-lg font-medium flex items-center justify-center btn-animate">
<i class="fas fa-shopping-cart mr-2"></i> Checkout
</button>
</div>
</div>
<!-- Main Content -->
<div class="content-container">
<!-- Home Page -->
<div id="home-page" class="page p-4">
<div class="card rounded-xl shadow-md p-5 mb-5 card-animate">
<h2 class="text-xl font-bold mb-4">Dashboard</h2>
<div class="grid grid-cols-2 gap-4">
<div class="card-water rounded-lg p-2">
<p class="text-sm text-gray-600">Stok Air Tersisa</p>
<p id="remaining-water" class="text-2xl font-bold text-[#0284c7]">--</p>
<p class="text-xs text-gray-500">Liter</p>
</div>
<div class="card-transactions rounded-lg p-2">
<p class="text-sm text-gray-600">Total Transaksi</p>
<p id="today-transactions" class="text-2xl font-bold text-[#16a34a]">--</p>
<p class="text-xs text-gray-500">Transaksi Hari Ini</p>
</div>
<div class="card-debts rounded-lg p-2">
<p class="text-sm text-gray-600">Total Hutang</p>
<p id="total-debts" class="text-2xl font-bold text-[#d97706]">--</p>
<p class="text-xs text-gray-500">Rp</p>
</div>
<div class="card-products rounded-lg p-2">
<p class="text-sm text-gray-600">Produk Tersedia</p>
<p id="available-products" class="text-2xl font-bold text-[#7e22ce]">--</p>
<p class="text-xs text-gray-500">Jenis</p>
</div>
<div class="card-cash rounded-lg p-4 col-span-2">
<p class="text-sm text-gray-600">Saldo Kas</p>
<p id="cash-balance" class="text-2xl font-bold text-[#3b82f6]">--</p>
<p class="text-xs text-gray-500">Rp</p>
</div>
</div>
</div>
<div class="card rounded-xl shadow-md p-5 card-animate">
<h3 class="font-semibold mb-3">Transaksi Terakhir</h3>
<div id="recent-transactions" class="space-y-3">
<!-- Transaction items will be loaded here -->
</div>
</div>
</div>
<!-- Products Page -->
<div id="products-page" class="page p-4 hidden">
<div class="card rounded-xl shadow-md p-5 mb-5 card-animate">
<div class="flex justify-between items-center mb-4">
<h2 class="text-xl font-bold">Produk</h2>
<div class="flex items-center space-x-2">
<button id="toggle-product-actions" onclick="toggleProductActions()" class="p-2 rounded-lg hover:bg-gray-200 transition">
<i class="fas fa-eye-slash text-gray-600"></i>
</button>
<button onclick="showAddProductModal()" class="btn-primary px-4 py-2 rounded-lg flex items-center btn-animate">
<i class="fas fa-plus mr-2"></i>
</button>
<button onclick="goToCheckout()" class="btn-primary px-4 py-2 rounded-lg font-medium flex items-center justify-center btn-animate">
<i class="fas fa-shopping-cart mr-2"></i> Checkout
</button>
</div>
</div>
<div id="products-list" class="space-y-3">
<!-- Products will be loaded here as list -->
</div>
</div>
</div>
<!-- Transaction Page -->
<div id="transaction-page" class="page p-4 hidden">
<div class="card rounded-xl shadow-md p-5 card-animate">
<div class="flex justify-between items-center mb-4">
<h2 class="text-xl font-bold">Transaksi Baru</h2>
<div class="text-xl font-bold text-[#134e4a]">
Rp <span id="cart-total-transaction">0</span>
</div>
</div>
<div class="mb-6">
<h3 class="font-semibold mb-2">Keranjang Belanja</h3>
<div id="cart-items" class="space-y-3 mb-3 max-h-60 overflow-y-auto">
<p class="text-center text-gray-500 py-4">Keranjang belanja kosong</p>
</div>
</div>
<div class="mb-4">
<label class="block text-sm font-medium mb-1">Pelanggan</label>
<div class="relative">
<input type="text" id="customer-input" class="flex-1 input-field rounded-lg px-3 py-2 w-full" placeholder="Ketik nama pelanggan..." autocomplete="off">
<div id="customer-suggestions" class="absolute z-10 w-full bg-white border border-gray-300 rounded-lg shadow-lg mt-1 max-h-60 overflow-y-auto hidden">
<!-- Suggestions will be loaded here -->
</div>
</div>
</div>
<div id="cash-payment-section" class="mb-4">
<div class="grid grid-cols-2 gap-4">
<div>
<label class="block text-sm font-medium mb-1">Uang Bayar (Rp)</label>
<input type="number" id="payment-amount" class="w-full input-field rounded-lg px-3 py-2 text-lg font-bold" placeholder="Masukkan jumlah uang">
</div>
<div>
<label class="block text-sm font-medium mb-1">Uang Kembalian (Rp)</label>
<div id="change-amount" class="w-full input-field rounded-lg px-3 py-2 text-lg font-bold bg-gray-100">0</div>
</div>
</div>
<div id="change-calculation" class="change-calculation mt-3 hidden">
<div class="flex justify-between items-center">
<span class="font-medium">Kembalian:</span>
<span id="change-text" class="change-amount">Rp 0</span>
</div>
</div>
<div id="short-calculation" class="change-calculation mt-3 hidden">
<div class="flex justify-between items-center">
<span class="font-medium">Kekurangan:</span>
<span id="short-text" class="short-amount">Rp 0</span>
</div>
</div>
<div id="exact-calculation" class="change-calculation mt-3 hidden">
<div class="flex justify-between items-center">
<span class="font-medium">Uang Pas:</span>
<span id="exact-text" class="exact-amount">Rp 0</span>
</div>
</div>
</div>
<div class="grid grid-cols-3 gap-2">
<button id="payment-cash" onclick="setPaymentMethod('cash')" class="payment-method active py-3 rounded-lg font-medium">Tunai</button>
<button id="payment-debt" onclick="setPaymentMethod('debt')" class="payment-method bg-gray-200 py-3 rounded-lg font-medium">Hutang</button>
<button onclick="processTransaction()" class="btn-primary py-3 rounded-lg font-medium flex items-center justify-center btn-animate">
<i class="fas fa-shopping-cart mr-2"></i> Proses
</button>
</div>
</div>
</div>
<!-- History Page -->
<div id="history-page" class="page p-4 hidden">
<div class="card rounded-xl shadow-md p-5 card-animate">
<h2 class="text-xl font-bold mb-4">Riwayat Transaksi</h2>
<div id="transactions-list" class="space-y-3">
<!-- Transactions will be loaded here -->
</div>
</div>
</div>
<!-- Water Stock Page -->
<div id="water-stock-page" class="page p-4 hidden">
<div class="card rounded-xl shadow-md p-5 mb-5 card-animate">
<h2 class="text-xl font-bold mb-4">Stok Air</h2>
<div class="grid grid-cols-2 gap-4 mb-6">
<div class="card-water rounded-lg p-2">
<p class="text-sm text-gray-600">Sisa Stok</p>
<p id="water-remaining" class="text-2xl font-bold text-[#0284c7]">--</p>
<p class="text-xs text-gray-500">Liter</p>
</div>
<div class="card-transactions rounded-lg p-2">
<p class="text-sm text-gray-600">Liter Terpakai</p>
<p id="water-used" class="text-2xl font-bold text-[#16a34a]">--</p>
<p class="text-xs text-gray-500">Liter</p>
</div>
<div class="card-debts rounded-lg p-2">
<p class="text-sm text-gray-600">Total Liter Terpakai</p>
<p id="total-water-used" class="text-2xl font-bold text-[#d97706]">--</p>
<p class="text-xs text-gray-500">Liter</p>
</div>
<div class="card-cash rounded-lg p-2">
<p class="text-sm text-gray-600">Kapasitas Toren</p>
<p id="tank-capacity-display" class="text-2xl font-bold text-[#3b82f6]">--</p>
<p class="text-xs text-gray-500">Liter</p>
</div>
</div>
<div class="mb-4">
<label class="block text-sm font-medium mb-1">Total Biaya Suplai (Rp)</label>
<div class="text-xl font-bold text-red-600">Rp <span id="total-supply-cost">0</span></div>
</div>
<center>
<button id="add-water-btn" onclick="showAddWaterModal()" class="p-8 btn-primary py-3 rounded-lg font-medium flex items-center justify-center disabled:bg-gray-400 disabled:cursor-not-allowed btn-animate">
<i class="fas fa-plus-circle mr-2"></i> Tambah Stok Air
</button>
</center>
<!-- Water Tank Visualization -->
<div class="mb-6">
<div class="flex flex-col items-center">
<div class="w-full water-tank">
<div class="water-tank-lid"></div>
<div id="water-alert" class="water-alert hidden">
<i class="fas fa-exclamation-triangle mr-1"></i> Stok Air Menipis!
</div>
<div id="water-level" class="water-level">
<div class="water-wave"></div>
</div>
<div class="water-level-indicator" id="water-percentage">0%</div>
</div>
<p class="mt-2 text-sm text-gray-600">Level Air</p>
</div>
</div>
<!-- Water Stock History -->
<div class="water-stock-history">
<h3 class="font-semibold mb-3">Riwayat Penambahan Stok Air</h3>
<div id="water-stock-history-list" class="card rounded-lg">
<!-- History items will be loaded here -->
</div>
</div>
</div>
</div>
<!-- Settings Page -->
<div id="settings-page" class="page p-4 hidden">
<div class="card rounded-xl shadow-md p-5 card-animate">
<h2 class="text-xl font-bold mb-4">Pengaturan</h2>
<!-- Theme Selector -->
<div class="mb-6">
<label class="block text-sm font-medium mb-2">Tema</label>
<div class="theme-selector">
<div class="theme-option theme-default active" onclick="setTheme('default')">
<div class="theme-icon">
<i class="fas fa-palette"></i>
</div>
<div class="theme-name">Default</div>
</div>
<div class="theme-option theme-dark" onclick="setTheme('dark')">
<div class="theme-icon">
<i class="fas fa-moon"></i>
</div>
<div class="theme-name">Dark</div>
</div>
<div class="theme-option theme-light" onclick="setTheme('light')">
<div class="theme-icon">
<i class="fas fa-sun"></i>
</div>
<div class="theme-name">Light</div>
</div>
</div>
</div>
<!-- Toast Notification Settings -->
<div class="mb-6">
<label class="block text-sm font-medium mb-2">Notifikasi</label>
<div class="grid grid-cols-2 gap-4 mb-3">
<div>
<label class="block text-xs text-gray-600 mb-1">Posisi</label>
<select id="toast-position" class="w-full input-field rounded-lg px-3 py-2 text-sm">
<option value="top-right">Kanan Atas</option>
<option value="top-left">Kiri Atas</option>
<option value="bottom-right">Kanan Bawah</option>
<option value="bottom-left">Kiri Bawah</option>
<option value="top-center">Tengah Atas</option>
</select>
</div>
<div>
<label class="block text-xs text-gray-600 mb-1">Gaya</label>
<select id="toast-style" class="w-full input-field rounded-lg px-3 py-2 text-sm">
<option value="modern">Modern</option>
<option value="card">Kartu</option>
<option value="minimal">Minimal</option>
</select>
</div>
</div>
</div>
<div class="mb-4">
<label class="block text-sm font-medium mb-1">Nama Usaha</label>
<input type="text" id="business-name-input" class="w-full input-field rounded-lg px-3 py-2">
</div>
<div class="mb-4">
<label class="block text-sm font-medium mb-1">Alamat Usaha</label>
<input type="text" id="business-address-input" class="w-full input-field rounded-lg px-3 py-2">
</div>
<div class="mb-4">
<label class="block text-sm font-medium mb-1">Kontak</label>
<input type="text" id="business-contact-input" class="w-full input-field rounded-lg px-3 py-2">
</div>
<div class="mb-4">
<label class="block text-sm font-medium mb-1">Logo (URL)</label>
<input type="text" id="business-logo-input" class="w-full input-field rounded-lg px-3 py-2">
</div>
<div class="mb-4">
<label class="block text-sm font-medium mb-1">Kapasitas Toren (Liter)</label>
<input type="number" id="settings-tank-capacity" class="w-full input-field rounded-lg px-3 py-2">
</div>
<div class="mb-4">
<label class="block text-sm font-medium mb-1">Biaya Suplai Air Tangki (Rp)</label>
<input type="number" id="settings-supply-cost" class="w-full input-field rounded-lg px-3 py-2">
</div>
<div class="mb-4">
<label class="block text-sm font-medium mb-1">API Script</label>
<input type="text" id="api-script-input" placeholder="AKfycby_6VvnaHFQ4hmJALaX5-Zk1bF-nHzyuGR_FfdDvtJfbu_YMWLsVycoCrtCT-DlyMAv" class="w-full input-field rounded-lg px-3 py-2" onchange="disableApiKeyInput()">
</div>
<!-- Local Storage Toggle -->
<div class="mb-4">
<div class="flex items-center justify-between">
<label class="block text-sm font-medium">Local Storage</label>
<label class="toggle-switch">
<input type="checkbox" id="local-storage-toggle" onchange="toggleLocalStorage()">
<span class="slider"></span>
</label>
</div>
<p class="text-xs text-gray-500 mt-1">Aktifkan untuk menyimpan data secara offline</p>
</div>
<div class="flex space-x-3">
<button onclick="clearLocalStorage()" class="flex-1 bg-red-500 text-white py-3 rounded-lg font-medium btn-animate">
<i class="fas fa-sync-alt mr-2"></i> Refresh Data
</button>
<button onclick="saveSettings()" class="flex-1 btn-primary py-3 rounded-lg font-medium btn-animate">
Simpan Pengaturan
</button>
</div>
</div>
</div>
<!-- Customers Page -->
<div id="customers-page" class="page p-4 hidden">
<div class="card rounded-xl shadow-md p-5 mb-5 card-animate">
<div class="flex justify-between items-center mb-4">
<h2 class="text-xl font-bold">Daftar Pelanggan</h2>
<button onclick="showAddCustomerModal()" class="btn-primary px-4 py-2 rounded-lg flex items-center btn-animate">
<i class="fas fa-plus mr-2"></i>
</button>
</div>
<div id="customers-list" class="space-y-3">
<!-- Customers will be loaded here -->
</div>
</div>
</div>
<!-- Expenses Page -->
<div id="expenses-page" class="page p-4 hidden">
<div class="card rounded-xl shadow-md p-5 mb-5 card-animate">
<div class="flex justify-between items-center mb-4">
<h2 class="text-xl font-bold">Keuangan</h2>
<button onclick="showAddExpenseModal()" class="btn-primary px-4 py-2 rounded-lg flex items-center btn-animate">
<i class="fas fa-plus mr-2"></i> Tambah
</button>
</div>
<div class="bg-blue-50 rounded-lg p-4 border border-blue-200">
<p class="text-sm text-gray-600">Saldo Tersedia</p>
<p id="current-cash-balance" class="text-3xl font-bold text-blue-600">--</p>
<p class="text-xs text-gray-500">Rp</p>
</div>
<div class="mt-4 grid grid-cols-2 gap-4">
<div class="bg-green-50 rounded-lg p-4 border border-green-200">
<p class="text-sm text-gray-600">Total Pemasukan</p>
<p id="total-income" class="text-2xl font-bold text-green-600">--</p>
<p class="text-xs text-gray-500">Rp</p>
</div>
<div class="bg-red-50 rounded-lg p-4 border border-red-200">
<p class="text-sm text-gray-600">Total Pengeluaran</p>
<p id="total-expenses" class="text-2xl font-bold text-red-600">--</p>
<p class="text-xs text-gray-500">Rp</p>
</div>
</div>
</div>
<div class="card rounded-xl shadow-md p-5 mb-5 card-animate">
<div class="flex justify-between items-center mb-4">
<h2 class="text-xl font-bold">Rincian Pengeluaran</h2>
</div>
<div id="expenses-list" class="space-y-3">
<!-- Expenses will be loaded here -->
</div>
</div>
<div class="card rounded-xl shadow-md p-5 card-animate">
<h2 class="text-xl font-bold mb-4">Saldo Sementara</h2>
<div class="grid grid-cols-2 gap-4">
<div class="bg-blue-50 rounded-lg p-4 border border-blue-200 col-span-2">
<p id="net-income" class="text-2xl font-bold text-blue-600">--</p>
<p class="text-xs text-gray-500">Rp</p>
</div>
</div>
</div>
</div>
<!-- Reports Page -->
<div id="reports-page" class="page p-4 hidden">
<div class="card rounded-xl shadow-md p-5 card-animate">
<h2 class="text-xl font-bold mb-4">Laporan</h2>
<div class="mb-4">
<label class="block text-sm font-medium mb-1">Periode</label>
<select id="report-period" class="w-full input-field rounded-lg px-3 py-2">
<option value="today">Hari Ini</option>
<option value="week">Minggu Ini</option>
<option value="month">Bulan Ini</option>
<option value="year">Tahun Ini</option>
</select>
</div>
<div class="grid grid-cols-2 gap-4 mb-6">
<div class="card-transactions rounded-lg p-2">
<p class="text-sm text-gray-600">Total Transaksi</p>
<p id="report-total-transactions" class="text-2l font-bold text-[#16a34a]">--</p>
</div>
<div class="card-water rounded-lg p-2">
<p class="text-sm text-gray-600">Total Pendapatan</p>
<p id="report-total-income" class="text-2l font-bold text-[#0284c7]">--</p>
</div>
<div class="card-debts rounded-lg p-2">
<p class="text-sm text-gray-600">Total Hutang</p>
<p id="report-total-debts" class="text-2l font-bold text-[#d97706]">--</p>
</div>
<div class="card-products rounded-lg p-2">
<p class="text-sm text-gray-600">Total Laba Kotor</p>
<p id="report-total-profit" class="text-2l font-bold text-[#7e22ce]">--</p>
</div>
</div>
<div class="mb-4">
<h3 class="font-semibold mb-2">Produk Terlaris</h3>
<div id="top-products" class="space-y-2">
<!-- Top products will be loaded here -->
</div>
</div>
<button onclick="generateReport()" class="w-full btn-primary py-3 rounded-lg font-medium btn-animate">
Tampilkan Laporan
</button>
</div>
</div>
<!-- Debts Page -->
<div id="debts-page" class="page p-4 hidden">
<div class="card rounded-xl shadow-md p-5 card-animate">
<h2 class="text-xl font-bold mb-4">Daftar Hutang</h2>
<div id="debts-list" class="space-y-3">
<!-- Debts will be loaded here -->
</div>
</div>
</div>
</div>
<!-- Bottom Navigation -->
<div id="bottom-nav" class="fixed bottom-0 left-0 right-0 flex justify-around items-center bottom-nav z-10">
<button onclick="showPage('home')" class="nav-btn active flex flex-col items-center justify-center p-2 text-white">
<i class="fas fa-home text-xl mb-1"></i>
<span class="text-xs">Home</span>
</button>
<button onclick="showPage('products')" class="nav-btn flex flex-col items-center justify-center mr-8 p-2 text-white">
<i class="fas fa-box text-xl mb-1"></i>
<span class="text-xs">Produk</span>
</button>
<button onclick="showPage('history')" class="nav-btn flex flex-col items-center justify-center ml-12 p-2 text-white">
<i class="fas fa-history text-xl mb-1"></i>
<span class="text-xs">Riwayat</span>
</button>
<button onclick="showPage('water-stock')" class="nav-btn flex flex-col items-center justify-center p-2 text-white">
<i class="fas fa-tint text-xl mb-1"></i>
<span class="text-xs">Stok</span>
</button>
</div>
<!-- Add Product Modal -->
<div id="add-product-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-20 hidden">
<div class="modal-content rounded-xl p-5 w-11/12 max-w-md">
<h3 class="text-lg font-bold mb-4">Tambah Produk</h3>
<div class="mb-4">
<label class="block text-sm font-medium mb-1">Nama Produk</label>
<input type="text" id="new-product-name" class="w-full input-field rounded-lg px-3 py-2">
</div>
<div class="mb-4">
<label class="block text-sm font-medium mb-1">Harga Jual (Rp)</label>
<input type="number" id="new-product-price" class="w-full input-field rounded-lg px-3 py-2">
</div>
<div class="mb-4">
<label class="block text-sm font-medium mb-1">Harga Pokok (Rp)</label>
<input type="number" id="new-product-cost" class="w-full input-field rounded-lg px-3 py-2">
</div>
<div class="mb-4">
<label class="block text-sm font-medium mb-1">Jenis</label>
<div class="product-type-selector">
<input type="text" id="new-product-type" class="w-full input-field rounded-lg px-3 py-2" readonly onclick="toggleProductTypeDropdown()">
<div id="product-type-dropdown" class="product-type-dropdown">
<div id="product-type-options"></div>
<div class="add-new-type" onclick="addNewProductType()">
<i class="fas fa-plus"></i>
<span>Tambah jenis baru</span>
</div>
</div>
</div>
</div>
<div class="mb-4">
<label class="block text-sm font-medium mb-1">Liter</label>
<input type="number" id="new-product-liter" step="0.1" class="w-full input-field rounded-lg px-3 py-2">
</div>
<div class="flex space-x-3">
<button onclick="closeModal('add-product-modal')" class="flex-1 bg-gray-200 py-2 rounded-lg font-medium btn-animate">Batal</button>
<button onclick="addProduct()" class="flex-1 btn-primary py-2 rounded-lg font-medium btn-animate">Simpan</button>
</div>
</div>
</div>
<!-- Edit Product Modal -->
<div id="edit-product-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-20 hidden">
<div class="modal-content rounded-xl p-5 w-11/12 max-w-md">
<h3 class="text-lg font-bold mb-4">Edit Produk</h3>
<input type="hidden" id="edit-product-id">
<div class="mb-4">
<label class="block text-sm font-medium mb-1">Nama Produk</label>
<input type="text" id="edit-product-name" class="w-full input-field rounded-lg px-3 py-2">
</div>
<div class="mb-4">
<label class="block text-sm font-medium mb-1">Harga Jual (Rp)</label>
<input type="number" id="edit-product-price" class="w-full input-field rounded-lg px-3 py-2">
</div>
<div class="mb-4">
<label class="block text-sm font-medium mb-1">Harga Pokok (Rp)</label>
<input type="number" id="edit-product-cost" class="w-full input-field rounded-lg px-3 py-2">
</div>
<div class="mb-4">
<label class="block text-sm font-medium mb-1">Jenis</label>
<div class="product-type-selector">
<input type="text" id="edit-product-type" class="w-full input-field rounded-lg px-3 py-2" readonly onclick="toggleEditProductTypeDropdown()">
<div id="edit-product-type-dropdown" class="product-type-dropdown">
<div id="edit-product-type-options"></div>
<div class="add-new-type" onclick="addNewEditProductType()">
<i class="fas fa-plus"></i>
<span>Tambah jenis baru</span>
</div>
</div>
</div>
</div>
<div class="mb-4">
<label class="block text-sm font-medium mb-1">Liter</label>
<input type="number" id="edit-product-liter" step="0.1" class="w-full input-field rounded-lg px-3 py-2">
</div>
<div class="flex space-x-3">
<button onclick="closeModal('edit-product-modal')" class="flex-1 bg-gray-200 py-2 rounded-lg font-medium btn-animate">Batal</button>
<button onclick="updateProduct()" class="flex-1 btn-primary py-2 rounded-lg font-medium btn-animate">Update</button>
</div>
</div>
</div>
<!-- Add Customer Modal -->
<div id="add-customer-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-20 hidden">
<div class="modal-content rounded-xl p-5 w-11/12 max-w-md">
<h3 class="text-lg font-bold mb-4">Tambah Pelanggan</h3>
<div class="mb-4">
<label class="block text-sm font-medium mb-1">Nama Pelanggan</label>
<input type="text" id="new-customer-name" class="w-full input-field rounded-lg px-3 py-2">
</div>
<div class="mb-4">
<label class="block text-sm font-medium mb-1">Kontak</label>
<input type="text" id="new-customer-contact" class="w-full input-field rounded-lg px-3 py-2">
</div>
<div class="mb-4">
<label class="block text-sm font-medium mb-1">Galon Titipan</label>
<input type="number" id="new-customer-deposit" min="0" value="0" class="w-full input-field rounded-lg px-3 py-2">
</div>
<div class="flex space-x-3">
<button onclick="closeModal('add-customer-modal')" class="flex-1 bg-gray-200 py-2 rounded-lg font-medium btn-animate">Batal</button>
<button onclick="addCustomer()" class="flex-1 btn-primary py-2 rounded-lg font-medium btn-animate">Simpan</button>
</div>
</div>
</div>
<!-- Edit Customer Modal -->
<div id="edit-customer-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-20 hidden">
<div class="modal-content rounded-xl p-5 w-11/12 max-w-md">
<h3 class="text-lg font-bold mb-4">Edit Pelanggan</h3>
<input type="hidden" id="edit-customer-id">
<div class="mb-4">
<label class="block text-sm font-medium mb-1">Nama Pelanggan</label>
<input type="text" id="edit-customer-name" class="w-full input-field rounded-lg px-3 py-2">
</div>
<div class="mb-4">
<label class="block text-sm font-medium mb-1">Kontak</label>
<input type="text" id="edit-customer-contact" class="w-full input-field rounded-lg px-3 py-2">
</div>
<div class="mb-4">
<label class="block text-sm font-medium mb-1">Galon Titipan</label>
<input type="number" id="edit-customer-deposit" min="0" value="0" class="w-full input-field rounded-lg px-3 py-2">
</div>
<div class="flex space-x-3">
<button onclick="closeModal('edit-customer-modal')" class="flex-1 bg-gray-200 py-2 rounded-lg font-medium btn-animate">Batal</button>
<button onclick="updateCustomer()" class="flex-1 btn-primary py-2 rounded-lg font-medium btn-animate">Update</button>
</div>
</div>
</div>
<!-- Add Water Modal -->
<div id="add-water-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-20 hidden">
<div class="modal-content rounded-xl p-5 w-11/12 max-w-md">
<h3 class="text-lg font-bold mb-4">Tambah Stok Air</h3>
<div class="mb-4">
<p class="text-sm text-gray-600 mb-2">Informasi Stok Air</p>
<div class="bg-gray-50 p-3 rounded-lg">
<p class="text-sm"><span class="font-medium">Kapasitas Toren:</span> <span id="modal-tank-capacity">--</span> Liter</p>
<p class="text-sm"><span class="font-medium">Biaya Suplai:</span> Rp <span id="modal-supply-cost">--</span></p>
</div>
</div>
<div class="flex space-x-3">
<button onclick="closeModal('add-water-modal')" class="flex-1 bg-gray-200 py-2 rounded-lg font-medium btn-animate">Batal</button>
<button onclick="addWaterStock()" class="flex-1 btn-primary py-3 rounded-lg font-medium btn-animate">
<i class="fas fa-plus-circle mr-2"></i> Tambah Stok
</button>
</div>
</div>
</div>
<!-- Add Expense Modal -->
<div id="add-expense-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-20 hidden">
<div class="modal-content rounded-xl p-5 w-11/12 max-w-md">
<h3 class="text-lg font-bold mb-4">Tambah Pengeluaran</h3>
<div class="mb-4">
<label class="block text-sm font-medium mb-1">Jenis Pengeluaran</label>
<select id="expense-type" class="w-full input-field rounded-lg px-3 py-2">
<option value="Stok Air">Stok Air</option>
<option value="Operasional">Operasional</option>
<option value="Lainnya">Lainnya</option>
</select>
</div>
<div class="mb-4">
<label class="block text-sm font-medium mb-1">Jumlah (Rp)</label>
<input type="number" id="expense-amount" class="w-full input-field rounded-lg px-3 py-2">
</div>
<div class="mb-4">
<label class="block text-sm font-medium mb-1">Keterangan</label>
<input type="text" id="expense-description" class="w-full input-field rounded-lg px-3 py-2">
</div>
<div class="flex space-x-3">
<button onclick="closeModal('add-expense-modal')" class="flex-1 bg-gray-200 py-2 rounded-lg font-medium btn-animate">Batal</button>
<button onclick="addExpense()" class="flex-1 btn-primary py-2 rounded-lg font-medium btn-animate">Simpan</button>
</div>
</div>
</div>
<!-- Transaction Receipt Modal -->
<div id="receipt-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-20 hidden">
<div class="modal-content rounded-xl p-5 w-11/12 max-w-md">
<div class="flex justify-between items-center mb-4">
<h3 class="text-lg font-bold">Nota Transaksi</h3>
<button onclick="closeModal('receipt-modal')" class="text-gray-500 hover:text-gray-700">
<i class="fas fa-times"></i>
</button>
</div>
<div id="receipt-content" class="receipt-container bg-white p-4 border border-gray-200 rounded-lg">
<!-- Receipt content will be loaded here -->
</div>
<div class="receipt-actions">
<div class="receipt-action-btn receipt-print-btn" onclick="printReceipt()" title="Cetak">
<i class="fas fa-print"></i>
</div>
<div class="receipt-action-btn receipt-download-btn" onclick="downloadReceipt()" title="Download">
<i class="fas fa-download"></i>
</div>
<div class="receipt-action-btn receipt-close-btn" onclick="closeModal('receipt-modal')" title="Tutup">
<i class="fas fa-times"></i>
</div>
</div>
</div>
</div>
<!-- Payment Debt Modal -->
<div id="payment-debt-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-20 hidden">
<div class="modal-content rounded-xl p-5 w-11/12 max-w-md">
<h3 class="text-lg font-bold mb-4">Pembayaran Hutang</h3>
<div class="mb-4">
<label class="block text-sm font-medium mb-1">Pelanggan</label>
<input type="text" id="debt-customer-name" class="w-full input-field rounded-lg px-3 py-2 bg-gray-100" readonly>
</div>
<div class="mb-4">
<label class="block text-sm font-medium mb-1">Jumlah Hutang (Rp)</label>
<input type="number" id="debt-amount" class="w-full input-field rounded-lg px-3 py-2 bg-gray-100" readonly>
</div>
<div class="mb-4">
<label class="block text-sm font-medium mb-1">Jumlah Pembayaran (Rp)</label>
<input type="number" id="payment-amount" class="w-full input-field rounded-lg px-3 py-2">
</div>
<div class="mb-4">
<label class="block text-sm font-medium mb-1">Sisa Hutang (Rp)</label>
<div class="text-xl font-bold text-red-600">Rp <span id="remaining-debt">0</span></div>
</div>
<div class="flex space-x-3">
<button onclick="closeModal('payment-debt-modal')" class="flex-1 bg-gray-200 py-2 rounded-lg font-medium btn-animate">Batal</button>
<button onclick="payDebt()" class="flex-1 btn-primary py-2 rounded-lg font-medium btn-animate">Bayar</button>
</div>
</div>
</div>
<!-- Toast Container -->
<div id="toast-container" class="toast-container top-right"></div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script>
// API Configuration
let API_KEY = 'AKfycby_6VvnaHFQ4hmJALaX5-Zk1bF-nHzyuGR_FfdDvtJfbu_YMWLsVycoCrtCT-DlyMAv';
const API_URL = 'https://script.google.com/macros/s/{API}/exec';
// Global Variables
let currentPaymentMethod = 'cash';
let currentDebtId = null;
let settings = {};
let products = [];
let customers = [];
let transactions = [];
let waterStock = {};
let expenses = [];
let cart = [];
let notifications = [];
let showProductActions = false;
let productClickCount = {};
let localStorageEnabled = false;
let currentReceiptData = null;
let currentTheme = 'default';
// Toast Notification Variables
let toastContainer = null;
let currentToastPosition = 'top-right'; // Default position
let currentToastStyle = 'modern'; // Default style
// Cache for data optimization
const dataCache = {
settings: null,
products: null,
customers: null,
lastUpdated: {
settings: 0,
products: 0,
customers: 0
}
};
const CACHE_EXPIRY = 5 * 60 * 1000; // 5 menit
// Real-time update cooldown
let lastUpdateTime = 0;
const UPDATE_COOLDOWN = 2000; // 2 detik cooldown
// Initialize App with optimized loading
document.addEventListener('DOMContentLoaded', function() {
// Detect reduced motion preference
const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
if (prefersReducedMotion) {
document.documentElement.style.setProperty('--animation-duration', '0s');
}
// Load theme preference
const savedTheme = localStorage.getItem('appTheme') || 'default';
setTheme(savedTheme);
// Load toast settings
const savedToastPosition = localStorage.getItem('toastPosition') || 'top-right';
const savedToastStyle = localStorage.getItem('toastStyle') || 'modern';
setToastPosition(savedToastPosition);
setToastStyle(savedToastStyle);
// Check if local storage is enabled
const localStorageStatus = localStorage.getItem('localStorageEnabled');
if (localStorageStatus === 'true') {
localStorageEnabled = true;
document.getElementById('local-storage-toggle').checked = true;
}
// Initialize customer autocomplete
initializeCustomerAutocomplete();
// Show initial loading overlay
const initialLoadingOverlay = document.getElementById('initial-loading-overlay');
const mainContentWrapper = document.getElementById('main-content-wrapper');
// Optimized loading with progressive enhancement
setTimeout(() => {
// Load critical data first
loadSettings()
.then(() => {
// Hide initial loading overlay with fade effect
initialLoadingOverlay.classList.add('hidden');
// Show main content with fade effect
setTimeout(() => {
mainContentWrapper.classList.add('visible');
showPage('home');
}, 300);
// Load remaining data in background
setTimeout(() => {
Promise.all([
loadProducts(),
loadCustomers(),
loadWaterStock(),
loadTransactions(),
loadExpenses(),
loadNotifications()
]).then(() => {
if (localStorageEnabled) {
saveDataToLocalStorage();
}
}).catch(error => {
console.error('Error loading background data:', error);
});
}, 500);
})
.catch(error => {
// Hide loading overlay even if there's an error
initialLoadingOverlay.classList.add('hidden');
setTimeout(() => {
mainContentWrapper.classList.add('visible');
showPage('home');
}, 300);
showToast('Gagal memuat data awal', 'error');
console.error(error);
});
}, 1000); // Show loading for at least 1 second
});
// Initialize Toast Container
function initializeToastContainer() {
if (!toastContainer) {
toastContainer = document.getElementById('toast-container');
if (!toastContainer) {
toastContainer = document.createElement('div');
toastContainer.className = `toast-container ${currentToastPosition}`;
document.body.appendChild(toastContainer);
}
}
}
// Show Toast Notification - Updated
function showToast(message, type = 'success', position = null, style = null, duration = 3000) {
// Initialize container if not exists
initializeToastContainer();
// Use provided position/style or default
const toastPosition = position || currentToastPosition;
const toastStyle = style || currentToastStyle;
// Update container position if different
if (!toastContainer.classList.contains(toastPosition)) {
toastContainer.className = `toast-container ${toastPosition}`;
}
// Create toast element
const toast = document.createElement('div');
toast.className = `toast ${toastStyle} ${type}`;
// Set icon based on type
let iconClass = 'fas fa-check-circle';
if (type === 'error') iconClass = 'fas fa-exclamation-circle';
if (type === 'warning') iconClass = 'fas fa-exclamation-triangle';
// Create toast HTML
toast.innerHTML = `
<i class="${iconClass} toast-icon"></i>
<div class="toast-content">
<p class="toast-message">${message}</p>
</div>
<button class="toast-close">
<i class="fas fa-times"></i>
</button>
<div class="toast-progress"></div>
`;
// Add to container
toastContainer.appendChild(toast);
// Add event listener for close button
const closeBtn = toast.querySelector('.toast-close');
closeBtn.addEventListener('click', () => {
hideToast(toast);
});
// Trigger animation
setTimeout(() => {
toast.classList.add('show');
}, 10);
// Auto hide after duration
const timeoutId = setTimeout(() => {
hideToast(toast);
}, duration);
// Store timeout ID for cleanup
toast.dataset.timeoutId = timeoutId;
return toast;
}
// Hide Toast
function hideToast(toast) {
if (!toast || toast.classList.contains('hiding')) return;
// Clear timeout if exists
if (toast.dataset.timeoutId) {
clearTimeout(parseInt(toast.dataset.timeoutId));
}
// Add hiding class
toast.classList.add('hiding');
// Remove after animation
setTimeout(() => {
if (toast.parentNode) {
toast.parentNode.removeChild(toast);
}
}, 400);
}
// Set Toast Position
function setToastPosition(position) {
currentToastPosition = position;
if (toastContainer) {
toastContainer.className = `toast-container ${position}`;
}
}
// Set Toast Style
function setToastStyle(style) {
currentToastStyle = style;
}
// Initialize Customer Autocomplete
function initializeCustomerAutocomplete() {
const customerInput = document.getElementById('customer-input');
const customerSuggestions = document.getElementById('customer-suggestions');
if (customerInput && customerSuggestions) {
customerInput.addEventListener('input', function(e) {
const value = e.target.value.toLowerCase();
if (value.length < 1) {
customerSuggestions.classList.add('hidden');
return;
}
// Filter customers based on input
const filteredCustomers = customers.filter(customer =>
customer['Nama'].toLowerCase().includes(value)
);
// Clear previous suggestions
customerSuggestions.innerHTML = '';
if (filteredCustomers.length === 0) {
customerSuggestions.classList.add('hidden');
return;
}
// Add filtered customers to suggestions
filteredCustomers.forEach(customer => {
const suggestion = document.createElement('div');
suggestion.className = 'px-4 py-2 hover:bg-gray-100 cursor-pointer border-b border-gray-100 last:border-b-0';
suggestion.textContent = customer['Nama'];
suggestion.onclick = function() {
customerInput.value = customer['Nama'];
customerInput.setAttribute('data-customer-id', customer['ID Pelanggan']);
customerSuggestions.classList.add('hidden');
};
customerSuggestions.appendChild(suggestion);
});
customerSuggestions.classList.remove('hidden');
});
// Close suggestions when clicking outside
document.addEventListener('click', function(e) {
if (customerInput && customerSuggestions && !customerInput.contains(e.target) && !customerSuggestions.contains(e.target)) {
customerSuggestions.classList.add('hidden');
}
});
}
}
// Save data to local storage
function saveDataToLocalStorage() {
if (!localStorageEnabled) return;
try {
const dataToSave = {
settings: settings,
products: products,
customers: customers,
transactions: transactions,
waterStock: waterStock,
expenses: expenses,
notifications: notifications
};
localStorage.setItem('kasirStokAirData', JSON.stringify(dataToSave));
} catch (error) {
console.error('Error saving data to local storage:', error);
showToast('Gagal menyimpan data ke local storage', 'error');
}
}
// Toggle Local Storage
function toggleLocalStorage() {
const toggle = document.getElementById('local-storage-toggle');
localStorageEnabled = toggle.checked;
if (localStorageEnabled) {
// Save current data to local storage
saveDataToLocalStorage();
localStorage.setItem('localStorageEnabled', 'true');
showToast('Local Storage diaktifkan. Data akan disimpan untuk akses offline.', 'success');
} else {
// Clear local storage
localStorage.removeItem('kasirStokAirData');
localStorage.setItem('localStorageEnabled', 'false');
showToast('Local Storage dinonaktifkan. Data di local storage telah dihapus.', 'warning');
}
}
// Show/Hide Loading
function showLoading() {
document.getElementById('loading-overlay').classList.add('active');
}
function hideLoading() {
document.getElementById('loading-overlay').classList.remove('active');
}
// Show Real-time Update Indicator with cooldown
function showRealtimeIndicator() {
const now = Date.now();
if (now - lastUpdateTime < UPDATE_COOLDOWN) {
return; // Skip if still in cooldown
}
lastUpdateTime = now;
const indicator = document.getElementById('realtime-indicator');
indicator.classList.add('show');
setTimeout(() => {
indicator.classList.remove('show');
}, 2000);
}
// Toggle Notification Panel
function toggleNotificationPanel() {
const notificationPanel = document.getElementById('notification-panel');
notificationPanel.classList.toggle('show');
// Close cart panel if open
const cartPanel = document.getElementById('cart-panel');
if (cartPanel.classList.contains('show')) {
cartPanel.classList.remove('show');
}
}
// Toggle Cart Panel
function toggleCartPanel() {
const cartPanel = document.getElementById('cart-panel');
cartPanel.classList.toggle('show');
// Close notification panel if open
const notificationPanel = document.getElementById('notification-panel');
if (notificationPanel.classList.contains('show')) {
notificationPanel.classList.remove('show');
}
}
// Close dropdown and notification panel when clicking outside
document.addEventListener('click', function(event) {
const notificationPanel = document.getElementById('notification-panel');
const cartPanel = document.getElementById('cart-panel');
const notificationButton = event.target.closest('button[onclick="toggleNotificationPanel()"]');
const cartButton = event.target.closest('button[onclick="toggleCartPanel()"]');
if (!notificationPanel.contains(event.target) && !notificationButton &&
!cartPanel.contains(event.target) && !cartButton) {
notificationPanel.classList.remove('show');
cartPanel.classList.remove('show');
}
// Close product type dropdowns when clicking outside
const productTypeDropdown = document.getElementById('product-type-dropdown');
const editProductTypeDropdown = document.getElementById('edit-product-type-dropdown');
if (productTypeDropdown && !productTypeDropdown.contains(event.target) &&
event.target.id !== 'new-product-type') {
productTypeDropdown.classList.remove('show');
}
if (editProductTypeDropdown && !editProductTypeDropdown.contains(event.target) &&
event.target.id !== 'edit-product-type') {
editProductTypeDropdown.classList.remove('show');
}
});
// Page Navigation
function showPage(pageId) {
// Hide all pages
document.querySelectorAll('.page').forEach(page => {
page.classList.add('hidden');
});
// Show selected page
document.getElementById(`${pageId}-page`).classList.remove('hidden');
// Update navigation
document.querySelectorAll('.nav-btn').forEach(btn => {
btn.classList.remove('active');
});
// Find the clicked button and mark it as active
const navButtons = document.querySelectorAll('.nav-btn');
let buttonFound = false;
navButtons.forEach(btn => {
if (btn.onclick && btn.onclick.toString().includes(`showPage('${pageId}')`)) {
btn.classList.add('active');
buttonFound = true;
}
});
// If no button found for the page, activate the home button
if (!buttonFound) {
navButtons.forEach(btn => {
if (btn.onclick && btn.onclick.toString().includes(`showPage('home')`)) {
btn.classList.add('active');
}
});
}
// Update header color based on page
updateHeaderColor(pageId);
// Update bottom navigation color to match header
updateBottomNavColor(pageId);
// Close notification panel and cart panel
document.getElementById('notification-panel').classList.remove('show');
document.getElementById('cart-panel').classList.remove('show');
// Load page specific data
if (pageId === 'home') {
loadDashboard();
} else if (pageId === 'history') {
loadTransactions();
} else if (pageId === 'water-stock') {
loadWaterStock();
loadWaterStockHistory();
} else if (pageId === 'settings') {
loadSettingsForm();
} else if (pageId === 'customers') {
loadCustomers();
} else if (pageId === 'debts') {
loadDebts();
} else if (pageId === 'expenses') {
loadExpenses();
loadFinancialSummary();
} else if (pageId === 'products') {
updateProductsList();
updateCartSummary();
} else if (pageId === 'transaction') {
updateCartDisplay();
} else if (pageId === 'reports') {
generateReport();
}
}
// Update Header Color Based on Page
function updateHeaderColor(pageId) {
const topNav = document.getElementById('top-nav');
// Remove all header color classes
topNav.className = topNav.className.replace(/header-\w+/g, '');
// Add appropriate header color class
switch(pageId) {
case 'home':
topNav.classList.add('header-home');
break;
case 'products':
topNav.classList.add('header-products');
break;
case 'transaction':
topNav.classList.add('header-transaction');
break;
case 'history':
topNav.classList.add('header-history');
break;
case 'water-stock':
topNav.classList.add('header-water-stock');
break;
case 'settings':
topNav.classList.add('header-settings');
break;
case 'customers':
topNav.classList.add('header-customers');
break;
case 'expenses':
topNav.classList.add('header-expenses');
break;
case 'reports':
topNav.classList.add('header-reports');
break;
case 'debts':
topNav.classList.add('header-debts');
break;
}
}
// Update Bottom Navigation Color to Match Header
function updateBottomNavColor(pageId) {
const bottomNav = document.getElementById('bottom-nav');
// Remove all header color classes
bottomNav.className = bottomNav.className.replace(/header-\w+/g, '');
bottomNav.className = bottomNav.className.replace(/bottom-nav/g, '');
// Add appropriate header color class
switch(pageId) {
case 'home':
bottomNav.classList.add('header-home', 'bottom-nav');
break;
case 'products':
bottomNav.classList.add('header-products', 'bottom-nav');
break;
case 'transaction':
bottomNav.classList.add('header-transaction', 'bottom-nav');
break;
case 'history':
bottomNav.classList.add('header-history', 'bottom-nav');
break;
case 'water-stock':
bottomNav.classList.add('header-water-stock', 'bottom-nav');
break;
case 'settings':
bottomNav.classList.add('header-settings', 'bottom-nav');
break;
case 'customers':
bottomNav.classList.add('header-customers', 'bottom-nav');
break;
case 'expenses':
bottomNav.classList.add('header-expenses', 'bottom-nav');
break;
case 'reports':
bottomNav.classList.add('header-reports', 'bottom-nav');
break;
case 'debts':
bottomNav.classList.add('header-debts', 'bottom-nav');
break;
default:
bottomNav.classList.add('header-home', 'bottom-nav');
}
}
// API Functions with Real-time Updates and Caching
async function fetchData(sheet, action, params = {}) {
// Check cache first for get-data actions
const now = Date.now();
if (action === 'get-data' && dataCache[sheet.toLowerCase()] &&
(now - dataCache.lastUpdated[sheet.toLowerCase()]) < CACHE_EXPIRY) {
return { success: true, data: dataCache[sheet.toLowerCase()] };
}
// If offline and local storage is enabled, try to get data from local storage
if (!navigator.onLine && localStorageEnabled) {
try {
const localData = localStorage.getItem('kasirStokAirData');
if (localData) {
const parsedData = JSON.parse(localData);
// Return appropriate data based on sheet
switch(sheet) {
case 'Pengaturan':
return { success: true, data: [parsedData.settings] };
case 'Produk':
return { success: true, data: parsedData.products };
case 'Pelanggan':
return { success: true, data: parsedData.customers };
case 'Transaksi':
return { success: true, data: parsedData.transactions };
case 'Stok Air':
return { success: true, data: [parsedData.waterStock] };
case 'Pengeluaran':
return { success: true, data: parsedData.expenses };
case 'Notifikasi':
return { success: true, data: parsedData.notifications };
}
}
} catch (error) {
console.error('Error loading data from local storage:', error);
}
}
// If online or local storage is disabled/not available, fetch from API
const url = API_URL.replace('{API}', API_KEY);
const fullUrl = new URL(url);
fullUrl.searchParams.append('sheet', sheet);
fullUrl.searchParams.append('action', action);
// Add timestamp for cache busting
fullUrl.searchParams.append('_', Date.now());
Object.keys(params).forEach(key => {
fullUrl.searchParams.append(key, params[key]);
});
try {
const response = await fetch(fullUrl);
const data = await response.json();
if (data.success) {
// Save to cache if it's a get-data action
if (action === 'get-data') {
dataCache[sheet.toLowerCase()] = data.data;
dataCache.lastUpdated[sheet.toLowerCase()] = now;
}
// Save data to local storage if enabled
if (localStorageEnabled) {
saveDataToLocalStorage();
}
// Trigger real-time updates
triggerRealTimeUpdates(sheet, action, data);
return data;
}
return { success: false, message: data.message || 'Unknown error' };
} catch (error) {
console.error('Error fetching data:', error);
// If offline and local storage is enabled, show offline message
if (!navigator.onLine && localStorageEnabled) {
showToast('Anda sedang offline. Menampilkan data yang tersimpan.', 'warning');
} else {
showToast('Terjadi kesalahan saat mengambil data', 'error');
}
return { success: false, message: 'Network error' };
}
}
// Trigger Real-time Updates with cooldown
function triggerRealTimeUpdates(sheet, action, data) {
// Show real-time indicator only for important updates
if (['Produk', 'Transaksi', 'Stok Air'].includes(sheet) &&
['insert', 'update', 'delete'].includes(action)) {
showRealtimeIndicator();
}
switch(sheet) {
case 'Produk':
if (action === 'insert' || action === 'update' || action === 'delete') {
updateProductsList();
updateCartSummary();
updateCartPanel();
// Update product select di halaman transaksi
const productSelect = document.getElementById('product-select');
if (productSelect) {
productSelect.innerHTML = '<option value="">Pilih Produk</option>';
products.forEach(product => {
const option = document.createElement('option');
option.value = product['ID Produk'];
option.textContent = `${product['Nama Produk']} - Rp ${parseInt(product['Harga Jual (Rp)']).toLocaleString('id-ID')}`;
productSelect.appendChild(option);
});
}
}
break;
case 'Transaksi':
if (action === 'insert') {
loadTransactions();
updateRecentTransactions();
loadFinancialSummary();
// Update dashboard jika sedang ditampilkan
if (!document.getElementById('home-page').classList.contains('hidden')) {
loadDashboard();
}
// Update history page if active
if (!document.getElementById('history-page').classList.contains('hidden')) {
updateTransactionsList();
}
}
break;
case 'Stok Air':
if (action === 'update') {
updateWaterTankVisualization();
checkWaterLevel();
// Update dashboard jika sedang ditampilkan
if (!document.getElementById('home-page').classList.contains('hidden')) {
loadDashboard();
}
// Update halaman stok air jika sedang ditampilkan
if (!document.getElementById('water-stock-page').classList.contains('hidden')) {
document.getElementById('water-remaining').textContent = waterStock['Sisa Liter'] || '0';
document.getElementById('water-used').textContent = waterStock['Liter Terpakai'] || '0';
document.getElementById('total-water-used').textContent = waterStock['Total Liter Terpakai'] || '0';
document.getElementById('total-supply-cost').textContent = parseInt(waterStock['Total Biaya Suplai (Rp)'] || 0).toLocaleString('id-ID');
}
}
break;
case 'Pelanggan':
if (action === 'insert' || action === 'update' || action === 'delete') {
updateCustomersList();
initializeCustomerAutocomplete();
}
break;
case 'Pengeluaran':
if (action === 'insert') {
updateExpensesList();
loadFinancialSummary();
// Update dashboard jika sedang ditampilkan
if (!document.getElementById('home-page').classList.contains('hidden')) {
loadDashboard();
}
}
break;
case 'Notifikasi':
if (action === 'insert' || action === 'update' || action === 'clear') {
updateNotificationBadge();
updateNotificationList();
}
break;
}
}
// Load Settings
async function loadSettings() {
const response = await fetchData('Pengaturan', 'get-data');
if (response.success && response.data.length > 0) {
settings = response.data[0];
// Update API key if available
if (settings['API']) {
API_KEY = settings['API'];
}
// Update UI with settings
document.getElementById('business-name').textContent = settings['Nama Usaha'] || 'Kasir Stok Air';
document.getElementById('business-address').textContent = settings['Alamat Usaha'] || 'Jl. Contoh No. 123';
// Update logo if available with improved error handling
if (settings['Logo'] && settings['Logo'].trim() !== '') {
const logoImg = document.getElementById('business-logo');
const logoIcon = document.getElementById('logo-icon');
const logoContainer = document.getElementById('logo-container');
const loadingLogoImg = document.getElementById('loading-logo-img');
const loadingLogoIcon = document.getElementById('loading-logo-icon');
// Reset classes
logoImg.classList.add('hidden');
logoIcon.classList.remove('hidden');
loadingLogoImg.classList.add('hidden');
loadingLogoIcon.classList.remove('hidden');
// Add timestamp for cache busting
const timestamp = new Date().getTime();
const logoUrl = settings['Logo'] + (settings['Logo'].includes('?') ? '&' : '?') + 't=' + timestamp;
// Set image source with proper error handling
logoImg.onload = function() {
// Image loaded successfully
logoImg.classList.remove('hidden');
logoIcon.classList.add('hidden');
// Also update loading logo to match header logo
loadingLogoImg.src = logoUrl;
loadingLogoImg.onload = function() {
loadingLogoImg.classList.remove('hidden');
loadingLogoIcon.classList.add('hidden');
};
loadingLogoImg.onerror = function() {
// If loading logo fails to load, keep the icon
loadingLogoImg.classList.add('hidden');
loadingLogoIcon.classList.remove('hidden');
};
console.log('Logo loaded successfully');
};
logoImg.onerror = function() {
// Image failed to load
logoImg.classList.add('hidden');
logoIcon.classList.remove('hidden');
console.error('Failed to load logo:', settings['Logo']);
showToast('Gagal memuat logo. Menggunakan ikon default.', 'warning');
};
// Set the src attribute
logoImg.src = logoUrl;
logoImg.alt = settings['Nama Usaha'] || 'Logo';
} else {
// No logo URL, ensure icon is visible
const logoImg = document.getElementById('business-logo');
const logoIcon = document.getElementById('logo-icon');
const loadingLogoImg = document.getElementById('loading-logo-img');
const loadingLogoIcon = document.getElementById('loading-logo-icon');
logoImg.classList.add('hidden');
logoIcon.classList.remove('hidden');
loadingLogoImg.classList.add('hidden');
loadingLogoIcon.classList.remove('hidden');
}
}
}
// Load Products
async function loadProducts() {
const response = await fetchData('Produk', 'get-data');
if (response.success) {
products = response.data;
// Initialize product click counts
products.forEach(product => {
const productId = product['ID Produk'];
if (!productClickCount[productId]) {
productClickCount[productId] = 0;
}
});
// Update product select in transaction page
const productSelect = document.getElementById('product-select');
if (productSelect) {
productSelect.innerHTML = '<option value="">Pilih Produk</option>';
products.forEach(product => {
const option = document.createElement('option');
option.value = product['ID Produk'];
option.textContent = `${product['Nama Produk']} - Rp ${parseInt(product['Harga Jual (Rp)']).toLocaleString('id-ID')}`;
productSelect.appendChild(option);
});
}
// Update products list
updateProductsList();
}
}
// Update Products List (optimized with DocumentFragment)
function updateProductsList() {
const productsList = document.getElementById('products-list');
if (!productsList) return;
// Use DocumentFragment for better performance
const fragment = document.createDocumentFragment();
if (products.length === 0) {
const emptyMessage = document.createElement('p');
emptyMessage.className = 'text-gray-500 text-center py-4';
emptyMessage.textContent = 'Belum ada produk';
fragment.appendChild(emptyMessage);
} else {
products.forEach((product, index) => {
const productItem = createProductListItem(product, index);
fragment.appendChild(productItem);
});
}
// Clear and update in one operation
productsList.innerHTML = '';
productsList.appendChild(fragment);
}
// Create Product List Item
function createProductListItem(product, index) {
const productId = product['ID Produk'];
const productItem = document.createElement('div');
productItem.className = 'product-list-item';
productItem.style.animationDelay = `${index * 0.05}s`;
productItem.style.animation = 'slideUp 0.3s ease-out forwards';
// Add click event to the entire item
productItem.onclick = function() {
addProductToCartFromProducts(productId);
};
// Create inner HTML
productItem.innerHTML = `
<div class="product-list-info">
<div class="product-list-name">${product['Nama Produk']}</div>
<div class="product-list-details">${product['Jenis']} - ${product['Liter']}L</div>
</div>
<div class="product-list-price">Rp ${parseInt(product['Harga Jual (Rp)']).toLocaleString('id-ID')}</div>
<div class="product-actions" ${showProductActions ? '' : 'style="display: none;"'}>
<button onclick="event.stopPropagation(); editProduct('${productId}')" class="text-[#134e4a] hover:text-[#0f766e]">
<i class="fas fa-edit"></i>
</button>
<button onclick="event.stopPropagation(); deleteProduct('${productId}')" class="text-red-600 hover:text-red-800">
<i class="fas fa-trash"></i>
</button>
</div>
`;
return productItem;
}
// Toggle Product Actions
function toggleProductActions() {
showProductActions = !showProductActions;
const toggleButton = document.getElementById('toggle-product-actions');
const productActions = document.querySelectorAll('.product-actions');
if (showProductActions) {
toggleButton.innerHTML = '<i class="fas fa-eye text-gray-600"></i>';
productActions.forEach(action => {
action.style.display = 'flex';
action.style.gap = '8px';
});
} else {
toggleButton.innerHTML = '<i class="fas fa-eye-slash text-gray-600"></i>';
productActions.forEach(action => {
action.style.display = 'none';
});
}
}
// Update Cart Summary on Products Page
function updateCartSummary() {
const cartSummary = document.getElementById('cart-summary');
const cartTotal = document.getElementById('cart-total');
const cartBadge = document.getElementById('cart-badge');
if (!cartSummary || !cartTotal || !cartBadge) return;
if (cart.length === 0) {
cartSummary.innerHTML = '<p class="text-center text-gray-500 py-2">Keranjang belanja kosong</p>';
cartTotal.textContent = '0';
cartBadge.classList.add('hidden');
return;
}
cartSummary.innerHTML = '';
let total = 0;
let totalItems = 0;
cart.forEach((item, index) => {
const itemTotal = item.price * item.quantity;
total += itemTotal;
totalItems += item.quantity;
const cartItem = document.createElement('div');
cartItem.className = 'flex justify-between items-center py-1';
cartItem.style.animationDelay = `${index * 0.05}s`;
cartItem.style.animation = 'slideUp 0.3s ease-out forwards';
cartItem.innerHTML = `
<div>
<p class="text-sm font-medium">${item.name}</p>
<p class="text-xs text-gray-600">${item.quantity} x Rp ${item.price.toLocaleString('id-ID')}</p>
</div>
<div class="flex items-center space-x-2">
<p class="text-sm font-medium">Rp ${itemTotal.toLocaleString('id-ID')}</p>
<button onclick="removeFromCart(${index})" class="text-red-600 hover:text-red-800">
<i class="fas fa-times-circle"></i>
</button>
</div>
`;
cartSummary.appendChild(cartItem);
});
cartTotal.textContent = total.toLocaleString('id-ID');
cartBadge.textContent = totalItems;
cartBadge.classList.remove('hidden');
}
// Update Cart Panel
function updateCartPanel() {
const cartList = document.getElementById('cart-list');
const cartPanelTotal = document.getElementById('cart-panel-total');
const cartBadge = document.getElementById('cart-badge');
if (!cartList || !cartPanelTotal || !cartBadge) return;
if (cart.length === 0) {
cartList.innerHTML = '<div class="cart-empty">Keranjang belanja kosong</div>';
cartPanelTotal.textContent = '0';
cartBadge.classList.add('hidden');
return;
}
cartList.innerHTML = '';
let total = 0;
let totalItems = 0;
cart.forEach((item, index) => {
const itemTotal = item.price * item.quantity;
total += itemTotal;
totalItems += item.quantity;
const cartItem = document.createElement('div');
cartItem.className = 'cart-item';
cartItem.style.animationDelay = `${index * 0.05}s`;
cartItem.style.animation = 'slideUp 0.3s ease-out forwards';
cartItem.innerHTML = `
<div class="flex justify-between items-center">
<div>
<p class="text-sm font-medium">${item.name}</p>
<p class="text-xs text-gray-600">${item.quantity} x Rp ${item.price.toLocaleString('id-ID')}</p>
</div>
<div class="flex items-center space-x-2">
<p class="text-sm font-medium">Rp ${itemTotal.toLocaleString('id-ID')}</p>
<button onclick="removeFromCart(${index})" class="text-red-600 hover:text-red-800">
<i class="fas fa-times-circle"></i>
</button>
</div>
</div>
`;
cartList.appendChild(cartItem);
});
cartPanelTotal.textContent = total.toLocaleString('id-ID');
cartBadge.textContent = totalItems;
cartBadge.classList.remove('hidden');
}
// Clear Cart
function clearCart() {
if (cart.length === 0) return;
if (!confirm('Apakah Anda yakin ingin mengosongkan keranjang belanja?')) return;
cart = [];
updateCartPanel();
updateCartSummary();
showToast('Keranjang belanja berhasil dikosongkan', 'success');
}
// Load Customers
async function loadCustomers() {
const response = await fetchData('Pelanggan', 'get-data');
if (response.success) {
customers = response.data;
// Update customer select in transaction page
const customerSelect = document.getElementById('customer-select');
if (customerSelect) {
customerSelect.innerHTML = '<option value="">Pilih Pelanggan</option>';
customers.forEach(customer => {
const option = document.createElement('option');
option.value = customer['ID Pelanggan'];
option.textContent = customer['Nama'];
customerSelect.appendChild(option);
});
}
// Update customers list
updateCustomersList();
}
}
// Update Customers List
function updateCustomersList() {
const customersList = document.getElementById('customers-list');
if (!customersList) return;
customersList.innerHTML = '';
if (customers.length === 0) {
customersList.innerHTML = '<p class="text-gray-500 text-center py-4">Belum ada pelanggan</p>';
return;
}
customers.forEach((customer, index) => {
const customerCard = document.createElement('div');
customerCard.className = 'cart-item rounded-lg p-4';
customerCard.style.animationDelay = `${index * 0.05}s`;
customerCard.style.animation = 'slideUp 0.3s ease-out forwards';
// Generate initials and color
const nameParts = customer['Nama'].split(' ');
const initials = nameParts.length >= 2
? nameParts[0].charAt(0) + nameParts[1].charAt(0)
: nameParts[0].charAt(0);
// Generate color based on name
const colors = [
{ bg: '#FF6B6B', text: '#FFFFFF' }, // Red
{ bg: '#4ECDC4', text: '#FFFFFF' }, // Teal
{ bg: '#FFD166', text: '#333333' }, // Yellow
{ bg: '#6A0572', text: '#FFFFFF' }, // Purple
{ bg: '#1A936F', text: '#FFFFFF' }, // Green
{ bg: '#114B5F', text: '#FFFFFF' }, // Dark Blue
{ bg: '#F45B69', text: '#FFFFFF' }, // Pink
{ bg: '#2EC4B6', text: '#FFFFFF' }, // Turquoise
];
const colorIndex = customer['Nama'].length % colors.length;
const selectedColor = colors[colorIndex];
customerCard.innerHTML = `
<div class="cart-item-content">
<div class="flex items-center">
<div class="w-12 h-12 rounded-full flex items-center justify-center text-lg font-bold mr-3"
style="background-color: ${selectedColor.bg}; color: ${selectedColor.text};">
${initials}
</div>
<div>
<h3 class="font-semibold">${customer['Nama']}</h3>
<p class="text-sm text-gray-600">${customer['Kontak']}</p>
</div>
</div>
</div>
<button class="cart-delete-btn" onclick="deleteCustomer('${customer['ID Pelanggan']}')">
<i class="fas fa-trash"></i>
</button>
`;
// Add double tap event for editing
let tapCount = 0;
let tapTimer = null;
customerCard.addEventListener('click', function() {
tapCount++;
if (tapCount === 2) {
// Double tap - edit customer
editCustomer(customer['ID Pelanggan']);
tapCount = 0;
clearTimeout(tapTimer);
} else {
// Single tap - set timer to reset tap count
clearTimeout(tapTimer);
tapTimer = setTimeout(() => {
tapCount = 0;
}, 300);
}
});
// Setup swipe listener
setupCustomerSwipeListener(customerCard);
customersList.appendChild(customerCard);
});
}
// Setup swipe listener for customer item
function setupCustomerSwipeListener(customerCard) {
let startX = 0;
let currentX = 0;
let isDragging = false;
const content = customerCard.querySelector('.cart-item-content');
const deleteBtn = customerCard.querySelector('.cart-delete-btn');
customerCard.addEventListener('touchstart', (e) => {
startX = e.touches[0].clientX;
isDragging = true;
content.style.transition = 'none';
deleteBtn.style.transition = 'none';
});
customerCard.addEventListener('touchmove', (e) => {
if (!isDragging) return;
currentX = e.touches[0].clientX;
const diffX = currentX - startX;
if (diffX < 0) { // swipe left
const translateX = Math.max(diffX, -80); // maksimal geser 80px ke kiri
content.style.transform = `translateX(${translateX}px)`;
deleteBtn.style.transform = `translateX(${translateX + 80}px)`;
}
});
customerCard.addEventListener('touchend', () => {
isDragging = false;
content.style.transition = 'transform 0.3s ease';
deleteBtn.style.transition = 'transform 0.3s ease';
const diffX = currentX - startX;
if (diffX < -50) { // threshold 50px
customerCard.classList.add('swipe-left');
} else {
content.style.transform = '';
deleteBtn.style.transform = '';
}
});
}
// Load Water Stock
async function loadWaterStock() {
const response = await fetchData('Stok Air', 'get-data');
if (response.success && response.data.length > 0) {
waterStock = response.data[0];
// Update UI
document.getElementById('remaining-water').textContent = waterStock['Sisa Liter'] || '0';
document.getElementById('water-remaining').textContent = waterStock['Sisa Liter'] || '0';
document.getElementById('water-used').textContent = waterStock['Liter Terpakai'] || '0';
document.getElementById('total-water-used').textContent = waterStock['Total Liter Terpakai'] || '0';
document.getElementById('total-supply-cost').textContent = parseInt(waterStock['Total Biaya Suplai (Rp)'] || 0).toLocaleString('id-ID');
// Update tank capacity display
const tankCapacity = parseInt(settings['Kapasitas Toren (Liter)'] || 0);
document.getElementById('tank-capacity-display').textContent = tankCapacity;
// Update water tank visualization
updateWaterTankVisualization();
// Check if water level is low and show notification
checkWaterLevel();
// Enable/disable add water button based on stock
const addWaterBtn = document.getElementById('add-water-btn');
if (addWaterBtn) {
if (parseInt(waterStock['Sisa Liter'] || 0) < 25) {
addWaterBtn.disabled = false;
} else {
addWaterBtn.disabled = true;
}
}
}
}
// Load Water Stock History dari Pengeluaran
async function loadWaterStockHistory() {
const response = await fetchData('Pengeluaran', 'get-data');
if (response.success) {
const historyList = document.getElementById('water-stock-history-list');
if (!historyList) return;
historyList.innerHTML = '';
// Filter data untuk jenis "Stok Air"
const waterStockExpenses = response.data.filter(expense =>
expense['Jenis'] && expense['Jenis'].toLowerCase() === 'stok air'
);
if (waterStockExpenses.length === 0) {
historyList.innerHTML = '<p class="text-gray-500 text-center py-4">Belum ada riwayat penambahan stok air</p>';
return;
}
// Sort history by date (newest first)
const historyData = waterStockExpenses.sort((a, b) => new Date(b['Tanggal']) - new Date(a['Tanggal']));
historyData.forEach((history, index) => {
const historyItem = document.createElement('div');
historyItem.className = 'history-item';
historyItem.style.animationDelay = `${index * 0.05}s`;
historyItem.style.animation = 'slideUp 0.3s ease-out forwards';
const date = new Date(history['Tanggal']);
const formattedDate = date.toLocaleDateString('id-ID', { day: 'numeric', month: 'short', year: 'numeric' });
// Ekstrak jumlah liter dari keterangan jika ada
const keterangan = history['Keterangan'] || '';
const literMatch = keterangan.match(/(\d+)\s*liter/i);
const jumlahLiter = literMatch ? literMatch[1] : '-';
historyItem.innerHTML = `
<div>
<p class="font-medium">${keterangan}</p>
<p class="history-date">${formattedDate}</p>
</div>
<div class="text-right">
<p class="history-amount">${jumlahLiter !== '-' ? jumlahLiter + ' Liter' : '-'}</p>
<p class="history-cost">Rp ${parseInt(history['Jumlah'] || 0).toLocaleString('id-ID')}</p>
</div>
`;
historyList.appendChild(historyItem);
});
}
}
// Update water tank visualization
function updateWaterTankVisualization() {
const remaining = parseInt(waterStock['Sisa Liter'] || 0);
const capacity = parseInt(settings['Kapasitas Toren (Liter)'] || 1000);
// Calculate percentage
const percentage = capacity > 0 ? Math.min(100, Math.max(0, (remaining / capacity) * 100)) : 0;
// Update water level
const waterLevel = document.getElementById('water-level');
if (waterLevel) {
waterLevel.style.height = `${percentage}%`;
// Change color based on percentage
if (percentage < 20) {
waterLevel.style.background = 'linear-gradient(to top, #ef4444, #fca5a5)';
} else if (percentage < 40) {
waterLevel.style.background = 'linear-gradient(to top, #f59e0b, #fcd34d)';
} else {
waterLevel.style.background = 'linear-gradient(to top, #0891b2, #67e8f9)';
}
}
// Update percentage text
const waterPercentage = document.getElementById('water-percentage');
if (waterPercentage) {
waterPercentage.textContent = `${Math.round(percentage)}%`;
}
// Show/hide water alert
const waterAlert = document.getElementById('water-alert');
if (waterAlert) {
if (percentage < 20) {
waterAlert.classList.remove('hidden');
} else {
waterAlert.classList.add('hidden');
}
}
}
// Check water level and show notification if low
function checkWaterLevel() {
const remaining = parseInt(waterStock['Sisa Liter'] || 0);
const capacity = parseInt(settings['Kapasitas Toren (Liter)'] || 1000);
// Calculate percentage
const percentage = capacity > 0 ? (remaining / capacity) * 100 : 0;
// Show notification if water level is below 20%
if (percentage < 20 && percentage > 0) {
addNotification('warning', `Stok air hampir habis! Sisa ${remaining} liter (${Math.round(percentage)}%)`);
}
}
// Load Notifications
async function loadNotifications() {
const response = await fetchData('Notifikasi', 'get-data');
if (response.success) {
notifications = response.data;
// Sort notifications by date (newest first)
notifications.sort((a, b) => new Date(b['Tanggal']) - new Date(a['Tanggal']));
// Ensure all notifications have status field
notifications.forEach(notification => {
if (!notification['Status']) {
notification['Status'] = 'enable';
}
});
// Update notification badge
updateNotificationBadge();
// Update notification list
updateNotificationList();
}
}
// Update Notification Badge
function updateNotificationBadge() {
const notificationBadge = document.getElementById('notification-badge');
// Filter notifications with status "enable"
const enabledNotifications = notifications.filter(n => n['Status'] !== 'disable');
if (enabledNotifications.length === 0) {
notificationBadge.classList.add('hidden');
} else {
notificationBadge.textContent = enabledNotifications.length > 99 ? '99+' : enabledNotifications.length;
notificationBadge.classList.remove('hidden');
}
}
// Update Notification List
function updateNotificationList() {
const notificationList = document.getElementById('notification-list');
if (!notificationList) return;
notificationList.innerHTML = '';
// Filter notifications with status "enable"
const enabledNotifications = notifications.filter(n => n['Status'] !== 'disable');
if (enabledNotifications.length === 0) {
notificationList.innerHTML = '<div class="notification-empty">Tidak ada notifikasi</div>';
return;
}
enabledNotifications.forEach((notification, index) => {
// Find original index in notifications array
const originalIndex = notifications.findIndex(n => n === notification);
const notificationItem = document.createElement('div');
notificationItem.className = 'notification-item';
notificationItem.style.animationDelay = `${index * 0.05}s`;
notificationItem.style.animation = 'slideUp 0.3s ease-out forwards';
// Add click event to toggle status
notificationItem.onclick = function() {
handleNotificationClick(originalIndex);
};
const date = new Date(notification['Tanggal']);
const formattedDate = date.toLocaleDateString('id-ID', { day: 'numeric', month: 'short', year: 'numeric' });
const formattedTime = date.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });
notificationItem.innerHTML = `
<div class="notification-date">${formattedDate} ${formattedTime}</div>
<div class="notification-text">${notification['Notifikasi']}</div>
`;
notificationList.appendChild(notificationItem);
});
}
// Handle Notification Click
function handleNotificationClick(index) {
const notification = notifications[index];
// Ensure notification has status field
if (!notification['Status']) {
notification['Status'] = 'enable';
}
// Update notification status to "disable" when clicked
updateNotificationStatus(index, 'disable');
}
// Update Notification Status
async function updateNotificationStatus(index, newStatus) {
const notification = notifications[index];
try {
// Update status in database
const response = await fetchData('Notifikasi', 'update', {
row: index + 2, // +2 because row 1 is header and row 2 is first data row
'Status': newStatus
});
if (response.success) {
// Update status in local array
notification['Status'] = newStatus;
// Update UI
updateNotificationList();
updateNotificationBadge();
showToast(`Notifikasi ${newStatus === 'enable' ? 'ditampilkan' : 'disembunyikan'}`, 'success');
// Reload page in background after updating notification status
reloadPageInBackground();
} else {
showToast('Gagal mengubah status notifikasi', 'error');
}
} catch (error) {
console.error('Error updating notification status:', error);
showToast('Terjadi kesalahan saat mengubah status notifikasi', 'error');
}
}
// Add Notification
async function addNotification(type, message) {
const date = new Date();
const notificationData = {
'Tanggal': date.toISOString(),
'Notifikasi': message,
'Status': 'enable' // Default status is enable
};
try {
// Add notification to database
const response = await fetchData('Notifikasi', 'insert', notificationData);
if (response.success) {
// Add to local notifications array
notifications.unshift(notificationData);
// Update UI
updateNotificationBadge();
updateNotificationList();
// Show toast notification
showToast(message, type);
// Reload page in background after adding notification
reloadPageInBackground();
}
} catch (error) {
console.error('Error adding notification:', error);
showToast(message, type); // Show toast even if database fails
}
}
// Clear Notifications
async function clearNotifications() {
if (notifications.length === 0) return;
if (!confirm('Apakah Anda yakin ingin menghapus semua notifikasi?')) return;
try {
// Delete all notifications from database
const response = await fetchData('Notifikasi', 'clear');
if (response.success) {
// Clear local notifications array
notifications = [];
// Update UI
updateNotificationBadge();
updateNotificationList();
showToast('Semua notifikasi berhasil dihapus', 'success');
// Reload page in background after clearing notifications
reloadPageInBackground();
}
} catch (error) {
console.error('Error clearing notifications:', error);
showToast('Gagal menghapus notifikasi', 'error');
}
}
// Load Transactions
async function loadTransactions() {
const response = await fetchData('Transaksi', 'get-data');
if (response.success) {
transactions = response.data;
// Sort transactions by date (newest first)
transactions.sort((a, b) => new Date(b['Tanggal']) - new Date(a['Tanggal']));
// Update transactions list
updateTransactionsList();
// Update recent transactions on home page
updateRecentTransactions();
}
}
// Update Transactions List
function updateTransactionsList() {
const transactionsList = document.getElementById('transactions-list');
if (!transactionsList) return;
transactionsList.innerHTML = '';
if (transactions.length === 0) {
transactionsList.innerHTML = '<p class="text-gray-500 text-center py-4">Belum ada transaksi</p>';
return;
}
transactions.slice(0, 10).forEach((transaction, index) => {
const transactionCard = document.createElement('div');
transactionCard.className = 'cart-item rounded-lg p-4';
transactionCard.style.animationDelay = `${index * 0.05}s`;
transactionCard.style.animation = 'slideUp 0.3s ease-out forwards';
const date = new Date(transaction['Tanggal']);
const formattedDate = date.toLocaleDateString('id-ID', { day: 'numeric', month: 'short', year: 'numeric' });
transactionCard.innerHTML = `
<div class="flex justify-between items-start">
<div>
<h3 class="font-semibold">${transaction['ID Transaksi']}</h3>
<p class="text-sm text-gray-600">${formattedDate} - ${transaction['Nama Pelanggan']}</p>
<p class="text-sm text-gray-600">${transaction['Produk']} (${transaction['Jumlah']})</p>
</div>
<div class="text-right">
<p class="font-medium text-[#134e4a]">Rp ${parseInt(transaction['Harga Jual (Rp)']).toLocaleString('id-ID')}</p>
<p class="text-xs ${transaction['Status'] === 'Lunas' ? 'text-green-600' : 'text-yellow-600'}">${transaction['Status']}</p>
<button onclick="printTransactionReceipt('${transaction['ID Transaksi']}')" class="mt-2 text-blue-600 hover:text-blue-800 text-sm">
<i class="fas fa-print mr-1"></i> Print
</button>
</div>
</div>
`;
transactionsList.appendChild(transactionCard);
});
}
// Load Expenses
async function loadExpenses() {
const response = await fetchData('Pengeluaran', 'get-data');
if (response.success) {
expenses = response.data;
// Sort expenses by date (newest first)
expenses.sort((a, b) => new Date(b['Tanggal']) - new Date(a['Tanggal']));
// Update expenses list
updateExpensesList();
}
}
// Update Expenses List
function updateExpensesList() {
const expensesList = document.getElementById('expenses-list');
if (!expensesList) return;
expensesList.innerHTML = '';
if (expenses.length === 0) {
expensesList.innerHTML = '<p class="text-gray-500 text-center py-4">Belum ada pengeluaran</p>';
return;
}
expenses.slice(0, 10).forEach((expense, index) => {
const expenseCard = document.createElement('div');
expenseCard.className = 'cart-item rounded-lg p-4';
expenseCard.style.animationDelay = `${index * 0.05}s`;
expenseCard.style.animation = 'slideUp 0.3s ease-out forwards';
const date = new Date(expense['Tanggal']);
const formattedDate = date.toLocaleDateString('id-ID', { day: 'numeric', month: 'short', year: 'numeric' });
// Ambil nilai saldo dengan aman
const saldo = parseInt(expense['Saldo'] || 0);
expenseCard.innerHTML = `
<div class="flex justify-between items-start">
<div>
<h3 class="font-semibold">${expense['Jenis']}</h3>
<p class="text-sm text-gray-600">${formattedDate}</p>
<p class="text-sm text-gray-600">${expense['Keterangan'] || '-'}</p>
</div>
<div class="text-right">
<p class="font-medium text-red-600">Rp ${parseInt(expense['Jumlah'] || 0).toLocaleString('id-ID')}</p>
<p class="text-sm ${saldo >= 0 ? 'text-green-600' : 'text-red-600'}">
Saldo: Rp ${saldo.toLocaleString('id-ID')}
</p>
</div>
</div>
`;
expensesList.appendChild(expenseCard);
});
}
// Load Financial Summary
function loadFinancialSummary() {
// Calculate total income from transactions (hanya yang statusnya Lunas)
const totalIncome = transactions
.filter(t => t['Status'] === 'Lunas')
.reduce((sum, t) => sum + parseInt(t['Harga Jual (Rp)'] || 0), 0);
// Calculate total expenses
const totalExpenses = expenses.reduce((sum, e) => sum + parseInt(e['Jumlah'] || 0), 0);
// Calculate net income (sisa saldo)
const netIncome = totalIncome - totalExpenses;
// Update UI
document.getElementById('total-income').textContent = totalIncome.toLocaleString('id-ID');
document.getElementById('total-expenses').textContent = totalExpenses.toLocaleString('id-ID');
document.getElementById('net-income').textContent = netIncome.toLocaleString('id-ID');
// Set color based on net income
const netIncomeElement = document.getElementById('net-income');
if (netIncomeElement) {
if (netIncome >= 0) {
netIncomeElement.className = 'text-2xl font-bold text-green-600';
} else {
netIncomeElement.className = 'text-2xl font-bold text-red-600';
}
}
// Update saldo kas di dashboard
updateCashBalance(netIncome);
// Update saldo kas di halaman expenses
const currentCashBalanceElement = document.getElementById('current-cash-balance');
if (currentCashBalanceElement) {
currentCashBalanceElement.textContent = netIncome.toLocaleString('id-ID');
if (netIncome >= 0) {
currentCashBalanceElement.className = 'text-3xl font-bold text-green-600';
} else {
currentCashBalanceElement.className = 'text-3xl font-bold text-red-600';
}
}
}
// Fungsi untuk update saldo kas di dashboard
function updateCashBalance(balance) {
const cashBalanceElement = document.getElementById('cash-balance');
if (cashBalanceElement) {
cashBalanceElement.textContent = balance.toLocaleString('id-ID');
// Set warna berdasarkan saldo
if (balance >= 0) {
cashBalanceElement.className = 'text-2xl font-bold text-blue-600';
} else {
cashBalanceElement.className = 'text-2xl font-bold text-red-600';
}
}
}
// Update Recent Transactions
function updateRecentTransactions() {
const recentTransactions = document.getElementById('recent-transactions');
if (!recentTransactions) return;
recentTransactions.innerHTML = '';
if (transactions.length === 0) {
recentTransactions.innerHTML = '<p class="text-gray-500 text-center py-4">Belum ada transaksi</p>';
return;
}
transactions.slice(0, 5).forEach((transaction, index) => {
const transactionCard = document.createElement('div');
transactionCard.className = 'cart-item rounded-lg p-3';
transactionCard.style.animationDelay = `${index * 0.05}s`;
transactionCard.style.animation = 'slideUp 0.3s ease-out forwards';
const date = new Date(transaction['Tanggal']);
const formattedDate = date.toLocaleDateString('id-ID', { day: 'numeric', month: 'short' });
transactionCard.innerHTML = `
<div class="flex justify-between items-center">
<div>
<p class="font-medium">${transaction['Nama Pelanggan']}</p>
<p class="text-xs text-gray-600">${formattedDate} - ${transaction['Produk']}</p>
</div>
<p class="font-medium text-[#134e4a]">Rp ${parseInt(transaction['Harga Jual (Rp)']).toLocaleString('id-ID')}</p>
</div>
`;
recentTransactions.appendChild(transactionCard);
});
}
// Load Dashboard
function loadDashboard() {
// Update remaining water
document.getElementById('remaining-water').textContent = waterStock['Sisa Liter'] || '0';
// Update today transactions
const today = new Date();
const todayDateString = today.toISOString().split('T')[0];
const todayTransactions = transactions.filter(t => {
const transactionDate = new Date(t['Tanggal']);
const transactionDateString = transactionDate.toISOString().split('T')[0];
return transactionDateString === todayDateString;
});
document.getElementById('today-transactions').textContent = todayTransactions.length;
// Update total debts
const totalDebts = transactions
.filter(t => t['Status'] === 'Hutang')
.reduce((sum, t) => sum + parseInt(t['Harga Jual (Rp)']), 0);
document.getElementById('total-debts').textContent = totalDebts.toLocaleString('id-ID');
// Update available products
document.getElementById('available-products').textContent = products.length;
// Update cash balance
const totalIncome = transactions
.filter(t => t['Status'] === 'Lunas')
.reduce((sum, t) => sum + parseInt(t['Harga Jual (Rp)'] || 0), 0);
const totalExpenses = expenses.reduce((sum, e) => sum + parseInt(e['Jumlah'] || 0), 0);
const cashBalance = totalIncome - totalExpenses;
updateCashBalance(cashBalance);
// Update recent transactions
updateRecentTransactions();
}
// Load Settings Form
function loadSettingsForm() {
document.getElementById('business-name-input').value = settings['Nama Usaha'] || '';
document.getElementById('business-address-input').value = settings['Alamat Usaha'] || '';
document.getElementById('business-contact-input').value = settings['Kontak'] || '';
document.getElementById('business-logo-input').value = settings['Logo'] || '';
document.getElementById('settings-tank-capacity').value = settings['Kapasitas Toren (Liter)'] || '';
document.getElementById('settings-supply-cost').value = settings['Biaya Suplai Air Tangki (Rp)'] || '';
document.getElementById('api-script-input').value = settings['API'] || '';
// Load toast settings
const savedToastPosition = localStorage.getItem('toastPosition') || 'top-right';
const savedToastStyle = localStorage.getItem('toastStyle') || 'modern';
document.getElementById('toast-position').value = savedToastPosition;
document.getElementById('toast-style').value = savedToastStyle;
}
// Load Debts
async function loadDebts() {
const response = await fetchData('Transaksi', 'get-data');
if (response.success) {
const allTransactions = response.data;
const debts = allTransactions.filter(t => t['Status'] === 'Hutang');
const debtsList = document.getElementById('debts-list');
if (!debtsList) return;
debtsList.innerHTML = '';
if (debts.length === 0) {
debtsList.innerHTML = '<p class="text-gray-500 text-center py-4">Tidak ada hutang</p>';
return;
}
debts.forEach((debt, index) => {
const debtCard = document.createElement('div');
debtCard.className = 'cart-item rounded-lg p-4';
debtCard.style.animationDelay = `${index * 0.05}s`;
debtCard.style.animation = 'slideUp 0.3s ease-out forwards';
const date = new Date(debt['Tanggal']);
const formattedDate = date.toLocaleDateString('id-ID', { day: 'numeric', month: 'short', year: 'numeric' });
debtCard.innerHTML = `
<div class="flex justify-between items-start">
<div>
<h3 class="font-semibold">${debt['Nama Pelanggan']}</h3>
<p class="text-sm text-gray-600">${formattedDate} - ${debt['ID Transaksi']}</p>
<p class="text-sm text-gray-600">${debt['Produk']} (${debt['Jumlah']})</p>
</div>
<div class="text-right">
<p class="font-medium text-yellow-600">Rp ${parseInt(debt['Harga Jual (Rp)']).toLocaleString('id-ID')}</p>
<button onclick="showPaymentDebtModal('${debt['ID Transaksi']}')" class="mt-2 btn-primary px-3 py-1 rounded text-sm btn-animate">
Bayar
</button>
</div>
</div>
`;
debtsList.appendChild(debtCard);
});
}
}
// Set Payment Method
function setPaymentMethod(method) {
currentPaymentMethod = method;
// Update UI
document.querySelectorAll('.payment-method').forEach(btn => {
btn.classList.remove('active');
btn.classList.add('bg-gray-200');
});
if (method === 'cash') {
document.getElementById('payment-cash').classList.remove('bg-gray-200');
document.getElementById('payment-cash').classList.add('active');
document.getElementById('cash-payment-section').style.display = 'block';
} else {
document.getElementById('payment-debt').classList.remove('bg-gray-200');
document.getElementById('payment-debt').classList.add('active');
document.getElementById('cash-payment-section').style.display = 'none';
}
}
// Add Product to Cart from Products Page
function addProductToCartFromProducts(productId) {
const product = products.find(p => p['ID Produk'] === productId);
if (!product) return;
// Check if product already in cart
const existingItemIndex = cart.findIndex(item => item.id === productId);
if (existingItemIndex !== -1) {
// Update quantity if already in cart
cart[existingItemIndex].quantity += 1;
} else {
// Add new item to cart with quantity 1
cart.push({
id: productId,
name: product['Nama Produk'],
price: parseInt(product['Harga Jual (Rp)']),
cost: parseInt(product['Harga Pokok (Rp)']),
liter: parseFloat(product['Liter']) || 0,
quantity: 1
});
}
// Update cart display
updateCartSummary();
updateCartPanel();
showToast(`${product['Nama Produk']} ditambahkan ke keranjang`, 'success');
}
// Go to Checkout
function goToCheckout() {
if (cart.length === 0) {
showToast('Keranjang belanja kosong', 'warning');
return;
}
showPage('transaction');
}
// Update Cart Display
function updateCartDisplay() {
const cartItems = document.getElementById('cart-items');
const cartTotal = document.getElementById('cart-total-transaction');
if (!cartItems || !cartTotal) return;
if (cart.length === 0) {
cartItems.innerHTML = '<p class="text-center text-gray-500 py-4">Keranjang belanja kosong</p>';
cartTotal.textContent = '0';
return;
}
cartItems.innerHTML = '';
let total = 0;
cart.forEach((item, index) => {
const itemTotal = item.price * item.quantity;
total += itemTotal;
const cartItem = document.createElement('div');
cartItem.className = 'cart-item rounded-lg shadow-sm';
cartItem.dataset.index = index;
cartItem.style.animationDelay = `${index * 0.05}s`;
cartItem.style.animation = 'slideUp 0.3s ease-out forwards';
cartItem.innerHTML = `
<div class="cart-item-content">
<div class="cart-product-name">${item.name}</div>
<div class="cart-product-details">
<div class="flex items-center bg-gray-100 rounded-lg p-1">
<button onclick="decreaseQuantity(${index})" class="bg-white text-gray-700 w-8 h-8 rounded-full flex items-center justify-center shadow-sm">
<i class="fas fa-minus text-xs"></i>
</button>
<input type="number" value="${item.quantity}" min="1" class="cart-quantity-input mx-2 input-field rounded px-2 py-1 text-sm w-16 text-center font-bold" onchange="updateQuantity(${index}, this.value)">
<button onclick="increaseQuantity(${index})" class="bg-white text-gray-700 w-8 h-8 rounded-full flex items-center justify-center shadow-sm">
<i class="fas fa-plus text-xs"></i>
</button>
</div>
<div class="cart-product-price">Rp ${itemTotal.toLocaleString('id-ID')}</div>
</div>
</div>
<button class="cart-delete-btn" onclick="removeFromCart(${index})">
<i class="fas fa-trash"></i>
</button>
`;
cartItems.appendChild(cartItem);
// Setup swipe listener for this cart item
setupCartItemSwipeListener(cartItem);
});
cartTotal.textContent = total.toLocaleString('id-ID');
// Auto-fill payment amount with total
const paymentAmountInput = document.getElementById('payment-amount');
if (paymentAmountInput) {
paymentAmountInput.value = total;
updateChangeCalculation();
}
// Update change calculation if payment method is cash
if (currentPaymentMethod === 'cash') {
updateChangeCalculation();
}
}
// Setup swipe listener for cart item
function setupCartItemSwipeListener(cartItem) {
let startX = 0;
let currentX = 0;
let isDragging = false;
const content = cartItem.querySelector('.cart-item-content');
const deleteBtn = cartItem.querySelector('.cart-delete-btn');
cartItem.addEventListener('touchstart', (e) => {
startX = e.touches[0].clientX;
isDragging = true;
content.style.transition = 'none';
deleteBtn.style.transition = 'none';
});
cartItem.addEventListener('touchmove', (e) => {
if (!isDragging) return;
currentX = e.touches[0].clientX;
const diffX = currentX - startX;
if (diffX < 0) { // swipe left
const translateX = Math.max(diffX, -80); // maksimal geser 80px ke kiri
content.style.transform = `translateX(${translateX}px)`;
deleteBtn.style.transform = `translateX(${translateX + 80}px)`;
}
});
cartItem.addEventListener('touchend', () => {
isDragging = false;
content.style.transition = 'transform 0.3s ease';
deleteBtn.style.transition = 'transform 0.3s ease';
const diffX = currentX - startX;
if (diffX < -50) { // threshold 50px
cartItem.classList.add('swipe-left');
} else {
content.style.transform = '';
deleteBtn.style.transform = '';
}
});
}
// Update Quantity
function updateQuantity(index, value) {
const quantity = parseInt(value) || 1;
if (quantity < 1) return;
cart[index].quantity = quantity;
updateCartDisplay();
updateCartPanel();
}
// Increase Quantity
function increaseQuantity(index) {
if (cart[index].quantity > 1) {
cart[index].quantity += 1;
updateCartDisplay();
updateCartPanel();
}
}
// Decrease Quantity
function decreaseQuantity(index) {
if (cart[index].quantity > 1) {
cart[index].quantity -= 1;
updateCartDisplay();
updateCartPanel();
}
}
// Remove from Cart
function removeFromCart(index) {
const removedItem = cart[index];
cart.splice(index, 1);
updateCartDisplay();
updateCartSummary();
updateCartPanel();
showToast(`${removedItem.name} dihapus dari keranjang`, 'warning');
}
// Update Change Calculation
function updateChangeCalculation() {
const paymentAmountInput = document.getElementById('payment-amount');
const paymentAmount = parseInt(paymentAmountInput.value) || 0;
// Calculate total
let total = 0;
cart.forEach(item => {
total += item.price * item.quantity;
});
// Hide all calculation displays
document.getElementById('change-calculation').classList.add('hidden');
document.getElementById('short-calculation').classList.add('hidden');
document.getElementById('exact-calculation').classList.add('hidden');
// Update change amount display
const changeAmountElement = document.getElementById('change-amount');
changeAmountElement.textContent = '0';
if (paymentAmount > 0) {
if (paymentAmount > total) {
// Show change calculation
document.getElementById('change-calculation').classList.remove('hidden');
const change = paymentAmount - total;
document.getElementById('change-text').textContent = `Rp ${change.toLocaleString('id-ID')}`;
changeAmountElement.textContent = change.toLocaleString('id-ID');
} else if (paymentAmount < total) {
// Show short calculation
document.getElementById('short-calculation').classList.remove('hidden');
const short = total - paymentAmount;
document.getElementById('short-text').textContent = `Rp ${short.toLocaleString('id-ID')}`;
changeAmountElement.textContent = `-${short.toLocaleString('id-ID')}`;
} else {
// Show exact calculation
document.getElementById('exact-calculation').classList.remove('hidden');
document.getElementById('exact-text').textContent = `Rp ${total.toLocaleString('id-ID')}`;
changeAmountElement.textContent = total.toLocaleString('id-ID');
}
}
}
// Process Transaction
async function processTransaction() {
if (cart.length === 0) {
showToast('Keranjang belanja kosong', 'warning');
return;
}
const customerInput = document.getElementById('customer-input');
const customerId = customerInput.getAttribute('data-customer-id') || '';
const customerName = customerInput.value || 'Pelanggan Baru';
const paymentAmountInput = document.getElementById('payment-amount');
const paymentAmount = parseInt(paymentAmountInput.value) || 0;
// Calculate totals
let totalPrice = 0;
let totalCost = 0;
let totalProfit = 0;
let totalLiter = 0;
cart.forEach(item => {
const itemTotal = item.price * item.quantity;
const itemCost = item.cost * item.quantity;
const itemProfit = itemTotal - itemCost;
const itemLiter = item.liter * item.quantity;
totalPrice += itemTotal;
totalCost += itemCost;
totalProfit += itemProfit;
totalLiter += itemLiter;
});
// Validate payment amount for cash payment
if (currentPaymentMethod === 'cash' && paymentAmount < totalPrice) {
showToast('Uang bayar kurang dari total belanja', 'error');
return;
}
// Generate transaction ID
const date = new Date();
const transactionId = `TRX-${date.getFullYear()}${(date.getMonth()+1).toString().padStart(2, '0')}${date.getDate().toString().padStart(2, '0')}-${Math.floor(Math.random() * 1000).toString().padStart(3, '0')}`;
// Prepare transaction data
const transactionData = {
'ID Transaksi': transactionId,
'Tanggal': date.toISOString(),
'Produk': cart.map(item => `${item.name} (${item.quantity})`).join(', '),
'Jumlah': cart.reduce((sum, item) => sum + item.quantity, 0),
'Harga Jual (Rp)': totalPrice,
'Harga Pokok (Rp)': totalCost,
'Laba Kotor (Rp)': totalProfit,
'Nama Pelanggan': customerName,
'Status': currentPaymentMethod === 'cash' ? 'Lunas' : 'Hutang'
};
// Show loading
showLoading();
try {
// Add transaction
const response = await fetchData('Transaksi', 'insert', transactionData);
if (response.success) {
// Update water stock
const currentRemaining = parseInt(waterStock['Sisa Liter'] || 0);
const currentUsed = parseInt(waterStock['Liter Terpakai'] || 0);
const currentTotalUsed = parseInt(waterStock['Total Liter Terpakai'] || 0);
const newRemaining = currentRemaining - totalLiter;
const newUsed = currentUsed + totalLiter;
const newTotalUsed = currentTotalUsed + totalLiter;
await fetchData('Stok Air', 'update', {
row: 2,
'Sisa Liter': newRemaining,
'Liter Terpakai': newUsed,
'Total Liter Terpakai': newTotalUsed
});
// Reset form
customerInput.value = '';
customerInput.removeAttribute('data-customer-id');
paymentAmountInput.value = '';
// Clear cart
const cartItems = [...cart]; // Create a copy of cart for receipt
cart = [];
updateCartDisplay();
updateCartSummary();
updateCartPanel();
// Hide cart badge after successful transaction
const cartBadge = document.getElementById('cart-badge');
cartBadge.classList.add('hidden');
// Calculate change
const change = currentPaymentMethod === 'cash' ? paymentAmount - totalPrice : 0;
// Show receipt
showReceipt(transactionData, cartItems, paymentAmount, change);
// Add notification
addNotification('success', `Transaksi berhasil! Total: Rp ${totalPrice.toLocaleString('id-ID')}`);
// Refresh data
await Promise.all([
loadTransactions(),
loadWaterStock(),
loadFinancialSummary()
]);
// Update history page if active
if (!document.getElementById('history-page').classList.contains('hidden')) {
updateTransactionsList();
}
showToast('Transaksi berhasil', 'success');
// Reload page in background after processing transaction
reloadPageInBackground();
} else {
showToast('Gagal menambah transaksi', 'error');
}
} catch (error) {
console.error(error);
showToast('Terjadi kesalahan saat memproses transaksi', 'error');
} finally {
hideLoading();
}
}
// Show Receipt
function showReceipt(transactionData, cartItems, paymentAmount = 0, change = 0) {
const receiptContent = document.getElementById('receipt-content');
const date = new Date(transactionData['Tanggal']);
const formattedDate = date.toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' });
const formattedTime = date.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });
// Calculate total
let totalAmount = 0;
cartItems.forEach(item => {
totalAmount += item.price * item.quantity;
});
// Store receipt data for download
currentReceiptData = {
transactionData: transactionData,
cartItems: cartItems,
paymentAmount: paymentAmount,
change: change,
formattedDate: formattedDate,
formattedTime: formattedTime,
totalAmount: totalAmount
};
// Generate receipt content with modern style like Alfamart/Indomart
let receiptHTML = `
<div class="receipt-header">
<div class="receipt-logo">
${settings['Logo'] ?
`<img src="${settings['Logo']}${settings['Logo'].includes('?') ? '&' : '?'}t=${Date.now()}" alt="Logo" crossorigin="anonymous" onerror="this.parentElement.innerHTML='<i class=\\'fas fa-tint\\'></i>'">` :
'<i class="fas fa-tint"></i>'
}
</div>
<div class="receipt-title">${settings['Nama Usaha'] || 'Kasir Stok Air'}</div>
<div class="receipt-subtitle">${settings['Alamat Usaha'] || 'Jl. Contoh No. 123'}</div>
<div class="receipt-subtitle">${settings['Kontak'] || '08123456789'}</div>
</div>
<div class="receipt-info">
<div class="receipt-row">
<span class="receipt-label">NOTA:</span>
<span class="receipt-value">${transactionData['ID Transaksi']}</span>
</div>
<div class="receipt-row">
<span class="receipt-label">TGL:</span>
<span class="receipt-value">${formattedDate}</span>
</div>
<div class="receipt-row">
<span class="receipt-label">JAM:</span>
<span class="receipt-value">${formattedTime}</span>
</div>
<div class="receipt-row">
<span class="receipt-label">KASIR:</span>
<span class="receipt-value">ADMIN</span>
</div>
</div>
<div class="receipt-items">
<div class="receipt-items-header">
<span class="receipt-item-name">NAMA BARANG</span>
<span class="receipt-item-qty">QTY</span>
<span class="receipt-item-price">HARGA</span>
<span class="receipt-item-total">TOTAL</span>
</div>
`;
// Add products to receipt
let itemNumber = 1;
cartItems.forEach(item => {
const itemTotal = item.price * item.quantity;
receiptHTML += `
<div class="receipt-item">
<span class="receipt-item-name">${itemNumber}. ${item.name}</span>
<span class="receipt-item-qty">${item.quantity}</span>
<span class="receipt-item-price">${item.price.toLocaleString('id-ID')}</span>
<span class="receipt-item-total">${itemTotal.toLocaleString('id-ID')}</span>
</div>
`;
itemNumber++;
});
receiptHTML += `
</div>
<div class="receipt-summary">
<div class="receipt-summary-row">
<span class="receipt-label">SUBTOTAL:</span>
<span class="receipt-value">Rp ${totalAmount.toLocaleString('id-ID')}</span>
</div>
<div class="receipt-summary-row">
<span class="receipt-label">DISKON:</span>
<span class="receipt-value">Rp 0</span>
</div>
<div class="receipt-summary-row receipt-total">
<span class="receipt-label">TOTAL BAYAR:</span>
<span class="receipt-value">Rp ${totalAmount.toLocaleString('id-ID')}</span>
</div>
</div>
`;
// Add payment information if cash payment
if (currentPaymentMethod === 'cash' && paymentAmount > 0) {
receiptHTML += `
<div class="receipt-payment">
<div class="receipt-row">
<span class="receipt-label">TUNAI:</span>
<span class="receipt-value">Rp ${paymentAmount.toLocaleString('id-ID')}</span>
</div>
<div class="receipt-row">
<span class="receipt-label">KEMBALI:</span>
<span class="receipt-value">Rp ${change.toLocaleString('id-ID')}</span>
</div>
</div>
`;
}
receiptHTML += `
<div class="receipt-footer">
<div>Terima kasih atas kunjungan Anda</div>
<div class="receipt-thank">SELAMAT BERBELANJA KEMBALI</div>
<div>Barang yang sudah dibeli tidak dapat dikembalikan</div>
</div>
`;
receiptContent.innerHTML = receiptHTML;
document.getElementById('receipt-modal').classList.remove('hidden');
}
// Print Receipt
function printReceipt() {
const receiptContent = document.getElementById('receipt-content').innerHTML;
const printWindow = window.open('', '_blank');
printWindow.document.write(`
<html>
<head>
<title>Nota Transaksi</title>
<style>
body {
font-family: 'Courier New', monospace;
width: 80mm;
font-size: 12px;
margin: 0;
padding: 10px;
line-height: 1.4;
}
.receipt-container {
width: 100%;
margin: 0 auto;
}
.receipt-header {
text-align: center;
margin-bottom: 15px;
padding-bottom: 10px;
border-bottom: 2px dashed #333;
}
.receipt-logo {
width: 60px;
height: 60px;
margin: 0 auto 10px;
background: #134e4a;
border-radius: 50%;
display: flex;
align-items: center;
justify-content: center;
color: white;
font-size: 24px;
overflow: hidden;
}
.receipt-logo img {
width: 100%;
height: 100%;
object-fit: cover;
}
.receipt-title {
font-size: 18px;
font-weight: bold;
margin-bottom: 5px;
color: #134e4a;
}
.receipt-subtitle {
font-size: 11px;
margin-bottom: 3px;
color: #555;
}
.receipt-info {
margin-bottom: 15px;
}
.receipt-row {
display: flex;
justify-content: space-between;
margin-bottom: 5px;
}
.receipt-label {
font-weight: bold;
color: #333;
}
.receipt-value {
color: #000;
}
.receipt-items {
margin-bottom: 15px;
}
.receipt-items-header {
display: flex;
justify-content: space-between;
font-weight: bold;
border-bottom: 1px solid #333;
padding-bottom: 5px;
margin-bottom: 5px;
}
.receipt-item {
display: flex;
justify-content: space-between;
margin-bottom: 5px;
}
.receipt-item-name {
flex: 1;
text-align: left;
}
.receipt-item-qty {
width: 30px;
text-align: center;
}
.receipt-item-price {
width: 70px;
text-align: right;
}
.receipt-item-total {
width: 80px;
text-align: right;
font-weight: bold;
}
.receipt-summary {
margin-bottom: 15px;
border-top: 1px dashed #333;
padding-top: 10px;
}
.receipt-summary-row {
display: flex;
justify-content: space-between;
margin-bottom: 5px;
}
.receipt-total {
font-size: 14px;
font-weight: bold;
border-top: 1px solid #333;
padding-top: 5px;
margin-top: 5px;
}
.receipt-payment {
margin-bottom: 15px;
}
.receipt-footer {
text-align: center;
margin-top: 15px;
padding-top: 10px;
border-top: 2px dashed #333;
font-size: 11px;
color: #555;
}
.receipt-thank {
font-weight: bold;
margin-top: 5px;
color: #134e4a;
}
</style>
</head>
<body>
<div class="receipt-container">
${receiptContent}
</div>
</body>
</html>
`);
printWindow.document.close();
printWindow.print();
}
// Download Receipt as Image
function downloadReceipt() {
if (!currentReceiptData) return;
const receiptElement = document.getElementById('receipt-content');
// Wait for all images to load before capturing
const images = receiptElement.querySelectorAll('img');
let loadedImages = 0;
if (images.length === 0) {
// If no images, directly download
captureAndDownloadReceipt(receiptElement);
} else {
// Wait for all images to load
images.forEach(img => {
if (img.complete) {
loadedImages++;
} else {
img.onload = () => {
loadedImages++;
if (loadedImages === images.length) {
captureAndDownloadReceipt(receiptElement);
}
};
img.onerror = () => {
loadedImages++;
if (loadedImages === images.length) {
captureAndDownloadReceipt(receiptElement);
}
};
}
});
// Check if all images are already loaded
if (loadedImages === images.length) {
captureAndDownloadReceipt(receiptElement);
}
}
}
// Capture and Download Receipt
function captureAndDownloadReceipt(receiptElement) {
html2canvas(receiptElement, {
scale: 2,
backgroundColor: '#ffffff',
logging: false,
useCORS: true, // Allow cross-origin images
allowTaint: true // Allow tainted cross-origin images
}).then(canvas => {
// Convert canvas to blob
canvas.toBlob(blob => {
// Create download link
const url = URL.createObjectURL(blob);
const a = document.createElement('a');
a.href = url;
a.download = `Nota-${currentReceiptData.transactionData['ID Transaksi']}.png`;
document.body.appendChild(a);
a.click();
document.body.removeChild(a);
URL.revokeObjectURL(url);
showToast('Nota berhasil diunduh', 'success');
}, 'image/png');
}).catch(error => {
console.error('Error generating receipt image:', error);
showToast('Gagal mengunduh nota', 'error');
});
}
// Print Transaction Receipt from History
function printTransactionReceipt(transactionId) {
const transaction = transactions.find(t => t['ID Transaksi'] === transactionId);
if (!transaction) return;
// Create receipt data from transaction
const date = new Date(transaction['Tanggal']);
const formattedDate = date.toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' });
const formattedTime = date.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });
// Parse products from transaction
const productsText = transaction['Produk'];
const productMatches = productsText.match(/([^,]+)\s*\((\d+)\)/g) || [];
const cartItems = productMatches.map(match => {
const [, name, quantity] = match.match(/([^,]+)\s*\((\d+)\)/);
const product = products.find(p => p['Nama Produk'] === name.trim());
return {
name: name.trim(),
quantity: parseInt(quantity),
price: product ? parseInt(product['Harga Jual (Rp)']) : 0
};
});
const totalPrice = parseInt(transaction['Harga Jual (Rp)']);
// Show receipt
showReceipt(transaction, cartItems, totalPrice, 0);
}
// Toggle Product Type Dropdown
function toggleProductTypeDropdown() {
const dropdown = document.getElementById('product-type-dropdown');
dropdown.classList.toggle('show');
if (dropdown.classList.contains('show')) {
populateProductTypeOptions('product-type-options');
}
}
// Toggle Edit Product Type Dropdown
function toggleEditProductTypeDropdown() {
const dropdown = document.getElementById('edit-product-type-dropdown');
dropdown.classList.toggle('show');
if (dropdown.classList.contains('show')) {
populateProductTypeOptions('edit-product-type-options');
}
}
// Populate Product Type Options
function populateProductTypeOptions(containerId) {
const container = document.getElementById(containerId);
container.innerHTML = '';
// Get unique product types
const productTypes = [...new Set(products.map(p => p['Jenis']))];
productTypes.forEach(type => {
const option = document.createElement('div');
option.className = 'product-type-option';
option.textContent = type;
option.onclick = function() {
selectProductType(type, containerId);
};
container.appendChild(option);
});
}
// Select Product Type
function selectProductType(type, containerId) {
const inputId = containerId === 'product-type-options' ? 'new-product-type' : 'edit-product-type';
document.getElementById(inputId).value = type;
// Close dropdown
const dropdownId = containerId === 'product-type-options' ? 'product-type-dropdown' : 'edit-product-type-dropdown';
document.getElementById(dropdownId).classList.remove('show');
}
// Add New Product Type
function addNewProductType() {
const newType = prompt('Masukkan jenis produk baru:');
if (newType && newType.trim()) {
document.getElementById('new-product-type').value = newType.trim();
document.getElementById('product-type-dropdown').classList.remove('show');
}
}
// Add New Edit Product Type
function addNewEditProductType() {
const newType = prompt('Masukkan jenis produk baru:');
if (newType && newType.trim()) {
document.getElementById('edit-product-type').value = newType.trim();
document.getElementById('edit-product-type-dropdown').classList.remove('show');
}
}
// Show Add Product Modal
function showAddProductModal() {
document.getElementById('add-product-modal').classList.remove('hidden');
}
// Add Product
async function addProduct() {
const name = document.getElementById('new-product-name').value;
const price = parseInt(document.getElementById('new-product-price').value) || 0;
const cost = parseInt(document.getElementById('new-product-cost').value) || 0;
const type = document.getElementById('new-product-type').value;
const liter = parseFloat(document.getElementById('new-product-liter').value) || 0;
if (!name) {
showToast('Masukkan nama produk', 'error');
return;
}
if (price <= 0) {
showToast('Harga jual harus lebih dari 0', 'error');
return;
}
if (!type) {
showToast('Pilih jenis produk', 'error');
return;
}
// Generate product ID
const productId = `PRD-${Date.now()}`;
// Calculate profit and margin
const profit = price - cost;
const margin = price > 0 ? (profit / price * 100).toFixed(2) : 0;
// Prepare product data
const productData = {
'ID Produk': productId,
'Nama Produk': name,
'Harga Jual (Rp)': price,
'Harga Pokok (Rp)': cost,
'Laba per Item (Rp)': profit,
'Margin (%)': margin,
'Jenis': type,
'Liter': liter
};
// Show loading
showLoading();
try {
// Add product
const response = await fetchData('Produk', 'insert', productData);
if (response.success) {
// Reset form
document.getElementById('new-product-name').value = '';
document.getElementById('new-product-price').value = '';
document.getElementById('new-product-cost').value = '';
document.getElementById('new-product-liter').value = '';
document.getElementById('new-product-type').value = '';
// Close modal
closeModal('add-product-modal');
// Refresh data
await loadProducts();
// Add notification
addNotification('success', `Produk "${name}" berhasil ditambahkan`);
showToast('Produk berhasil ditambahkan', 'success');
// Reload page in background after adding product
reloadPageInBackground();
} else {
showToast('Gagal menambah produk', 'error');
}
} catch (error) {
console.error(error);
showToast('Terjadi kesalahan saat menambah produk', 'error');
} finally {
hideLoading();
}
}
// Edit Product
function editProduct(productId) {
const product = products.find(p => p['ID Produk'] === productId);
if (!product) return;
// Fill form with product data
document.getElementById('edit-product-id').value = product['ID Produk'];
document.getElementById('edit-product-name').value = product['Nama Produk'];
document.getElementById('edit-product-price').value = product['Harga Jual (Rp)'];
document.getElementById('edit-product-cost').value = product['Harga Pokok (Rp)'];
document.getElementById('edit-product-type').value = product['Jenis'];
document.getElementById('edit-product-liter').value = product['Liter'];
// Show modal
document.getElementById('edit-product-modal').classList.remove('hidden');
}
// Update Product
async function updateProduct() {
const productId = document.getElementById('edit-product-id').value;
const name = document.getElementById('edit-product-name').value;
const price = parseInt(document.getElementById('edit-product-price').value) || 0;
const cost = parseInt(document.getElementById('edit-product-cost').value) || 0;
const type = document.getElementById('edit-product-type').value;
const liter = parseFloat(document.getElementById('edit-product-liter').value) || 0;
if (!name) {
showToast('Masukkan nama produk', 'error');
return;
}
if (price <= 0) {
showToast('Harga jual harus lebih dari 0', 'error');
return;
}
if (!type) {
showToast('Pilih jenis produk', 'error');
return;
}
// Calculate profit and margin
const profit = price - cost;
const margin = price > 0 ? (profit / price * 100).toFixed(2) : 0;
// Find product index
const productIndex = products.findIndex(p => p['ID Produk'] === productId);
if (productIndex === -1) return;
// Prepare product data
const productData = {
row: productIndex + 2,
'Nama Produk': name,
'Harga Jual (Rp)': price,
'Harga Pokok (Rp)': cost,
'Laba per Item (Rp)': profit,
'Margin (%)': margin,
'Jenis': type,
'Liter': liter
};
// Show loading
showLoading();
try {
// Update product
const response = await fetchData('Produk', 'update', productData);
if (response.success) {
// Close modal
closeModal('edit-product-modal');
// Refresh data
await loadProducts();
// Add notification
addNotification('success', `Produk "${name}" berhasil diperbarui`);
showToast('Produk berhasil diperbarui', 'success');
// Reload page in background after updating product
reloadPageInBackground();
} else {
showToast('Gagal memperbarui produk', 'error');
}
} catch (error) {
console.error(error);
showToast('Terjadi kesalahan saat memperbarui produk', 'error');
} finally {
hideLoading();
}
}
// Delete Product
async function deleteProduct(productId) {
if (!confirm('Apakah Anda yakin ingin menghapus produk ini?')) return;
// Find product index
const productIndex = products.findIndex(p => p['ID Produk'] === productId);
if (productIndex === -1) return;
const productName = products[productIndex]['Nama Produk'];
// Show loading
showLoading();
try {
// Delete product
const response = await fetchData('Produk', 'delete', {
row: productIndex + 2
});
if (response.success) {
// Refresh data
await loadProducts();
// Add notification
addNotification('warning', `Produk "${productName}" berhasil dihapus`);
showToast('Produk berhasil dihapus', 'success');
// Reload page in background after deleting product
reloadPageInBackground();
} else {
showToast('Gagal menghapus produk', 'error');
}
} catch (error) {
console.error(error);
showToast('Terjadi kesalahan saat menghapus produk', 'error');
} finally {
hideLoading();
}
}
// Show Add Customer Modal
function showAddCustomerModal() {
document.getElementById('add-customer-modal').classList.remove('hidden');
}
// Add Customer
async function addCustomer() {
const name = document.getElementById('new-customer-name').value;
const contact = document.getElementById('new-customer-contact').value;
const deposit = parseInt(document.getElementById('new-customer-deposit').value) || 0;
if (!name) {
showToast('Masukkan nama pelanggan', 'error');
return;
}
// Generate customer ID
const customerId = `CUST-${Date.now()}`;
// Prepare customer data
const customerData = {
'ID Pelanggan': customerId,
'Nama': name,
'Kontak': contact,
'Galon Titipan': deposit
};
// Show loading
showLoading();
try {
// Add customer
const response = await fetchData('Pelanggan', 'insert', customerData);
if (response.success) {
// Reset form
document.getElementById('new-customer-name').value = '';
document.getElementById('new-customer-contact').value = '';
document.getElementById('new-customer-deposit').value = '0';
// Close modal
closeModal('add-customer-modal');
// Refresh data
await loadCustomers();
// Add notification
addNotification('success', `Pelanggan "${name}" berhasil ditambahkan`);
showToast('Pelanggan berhasil ditambahkan', 'success');
// Reload page in background after adding customer
reloadPageInBackground();
} else {
showToast('Gagal menambah pelanggan', 'error');
}
} catch (error) {
console.error(error);
showToast('Terjadi kesalahan saat menambah pelanggan', 'error');
} finally {
hideLoading();
}
}
// Edit Customer
function editCustomer(customerId) {
const customer = customers.find(c => c['ID Pelanggan'] === customerId);
if (!customer) return;
// Fill form with customer data
document.getElementById('edit-customer-id').value = customer['ID Pelanggan'];
document.getElementById('edit-customer-name').value = customer['Nama'];
document.getElementById('edit-customer-contact').value = customer['Kontak'];
document.getElementById('edit-customer-deposit').value = customer['Galon Titipan'];
// Show modal
document.getElementById('edit-customer-modal').classList.remove('hidden');
}
// Update Customer
async function updateCustomer() {
const customerId = document.getElementById('edit-customer-id').value;
const name = document.getElementById('edit-customer-name').value;
const contact = document.getElementById('edit-customer-contact').value;
const deposit = parseInt(document.getElementById('edit-customer-deposit').value) || 0;
if (!name) {
showToast('Masukkan nama pelanggan', 'error');
return;
}
// Find customer index
const customerIndex = customers.findIndex(c => c['ID Pelanggan'] === customerId);
if (customerIndex === -1) return;
// Prepare customer data
const customerData = {
row: customerIndex + 2,
'Nama': name,
'Kontak': contact,
'Galon Titipan': deposit
};
// Show loading
showLoading();
try {
// Update customer
const response = await fetchData('Pelanggan', 'update', customerData);
if (response.success) {
// Close modal
closeModal('edit-customer-modal');
// Refresh data
await loadCustomers();
// Add notification
addNotification('success', `Pelanggan "${name}" berhasil diperbarui`);
showToast('Pelanggan berhasil diperbarui', 'success');
// Reload page in background after updating customer
reloadPageInBackground();
} else {
showToast('Gagal memperbarui pelanggan', 'error');
}
} catch (error) {
console.error(error);
showToast('Terjadi kesalahan saat memperbarui pelanggan', 'error');
} finally {
hideLoading();
}
}
// Delete Customer
async function deleteCustomer(customerId) {
if (!confirm('Apakah Anda yakin ingin menghapus pelanggan ini?')) return;
// Find customer index
const customerIndex = customers.findIndex(c => c['ID Pelanggan'] === customerId);
if (customerIndex === -1) return;
const customerName = customers[customerIndex]['Nama'];
// Show loading
showLoading();
try {
// Delete customer
const response = await fetchData('Pelanggan', 'delete', {
row: customerIndex + 2
});
if (response.success) {
// Refresh data
await loadCustomers();
// Add notification
addNotification('warning', `Pelanggan "${customerName}" berhasil dihapus`);
showToast('Pelanggan berhasil dihapus', 'success');
// Reload page in background after deleting customer
reloadPageInBackground();
} else {
showToast('Gagal menghapus pelanggan', 'error');
}
} catch (error) {
console.error(error);
showToast('Terjadi kesalahan saat menghapus pelanggan', 'error');
} finally {
hideLoading();
}
}
// Show Add Water Modal
function showAddWaterModal() {
// Update modal with settings values
const tankCapacity = parseInt(settings['Kapasitas Toren (Liter)'] || 1000);
const supplyCost = parseInt(settings['Biaya Suplai Air Tangki (Rp)'] || 0);
document.getElementById('modal-tank-capacity').textContent = tankCapacity;
document.getElementById('modal-supply-cost').textContent = supplyCost.toLocaleString('id-ID');
document.getElementById('add-water-modal').classList.remove('hidden');
}
// Add Water Stock
async function addWaterStock() {
// Get values from settings
const tankCapacity = parseInt(settings['Kapasitas Toren (Liter)'] || 1000);
const supplyCost = parseInt(settings['Biaya Suplai Air Tangki (Rp)'] || 0);
// Get current water stock
const currentRemaining = parseInt(waterStock['Sisa Liter'] || 0);
const currentUsed = parseInt(waterStock['Liter Terpakai'] || 0);
const currentTotalUsed = parseInt(waterStock['Total Liter Terpakai'] || 0);
const currentTotalCost = parseInt(waterStock['Total Biaya Suplai (Rp)'] || 0);
// Calculate new values
const newRemaining = tankCapacity;
const newUsed = 0;
const newTotalUsed = currentTotalUsed;
const newTotalCost = currentTotalCost + supplyCost;
// Show loading
showLoading();
try {
// Update water stock
const response = await fetchData('Stok Air', 'update', {
row: 2,
'Sisa Liter': newRemaining,
'Liter Terpakai': newUsed,
'Total Liter Terpakai': newTotalUsed,
'Total Biaya Suplai (Rp)': newTotalCost
});
if (response.success) {
// Hitung total pemasukan saat ini
const totalIncome = transactions
.filter(t => t['Status'] === 'Lunas')
.reduce((sum, t) => sum + parseInt(t['Harga Jual (Rp)'] || 0), 0);
// Hitung total pengeluaran saat ini
const currentTotalExpenses = expenses.reduce((sum, e) => sum + parseInt(e['Jumlah'] || 0), 0);
// Hitung saldo setelah pengeluaran baru
const newBalance = totalIncome - (currentTotalExpenses + supplyCost);
// Add expense dengan format yang sesuai
const date = new Date();
const expenseData = {
'Tanggal': date.toISOString().split('T')[0],
'Keterangan': `Penambahan stok air ${tankCapacity} liter`,
'Jenis': 'Stok Air',
'Jumlah': supplyCost,
'Saldo': newBalance
};
await fetchData('Pengeluaran', 'insert', expenseData);
// Close modal
closeModal('add-water-modal');
// Add notification
addNotification('success', `Stok air berhasil ditambahkan! Kapasitas: ${tankCapacity} liter`);
// Refresh data
await Promise.all([
loadWaterStock(),
loadWaterStockHistory(),
loadExpenses(),
loadFinancialSummary()
]);
showToast('Stok air berhasil ditambahkan', 'success');
// Reload page in background after adding water stock
reloadPageInBackground();
} else {
showToast('Gagal menambah stok air', 'error');
}
} catch (error) {
console.error(error);
showToast('Terjadi kesalahan saat menambah stok air', 'error');
} finally {
hideLoading();
}
}
// Show Add Expense Modal
function showAddExpenseModal() {
document.getElementById('add-expense-modal').classList.remove('hidden');
}
// Add Expense
async function addExpense() {
const type = document.getElementById('expense-type').value;
const amount = parseInt(document.getElementById('expense-amount').value) || 0;
const description = document.getElementById('expense-description').value;
if (amount <= 0) {
showToast('Jumlah harus lebih dari 0', 'error');
return;
}
// Hitung total pemasukan saat ini
const totalIncome = transactions
.filter(t => t['Status'] === 'Lunas')
.reduce((sum, t) => sum + parseInt(t['Harga Jual (Rp)'] || 0), 0);
// Hitung total pengeluaran saat ini
const currentTotalExpenses = expenses.reduce((sum, e) => sum + parseInt(e['Jumlah'] || 0), 0);
// Hitung saldo setelah pengeluaran baru
const newBalance = totalIncome - (currentTotalExpenses + amount);
// Generate expense data
const date = new Date();
const expenseData = {
'Tanggal': date.toISOString().split('T')[0],
'Keterangan': description,
'Jenis': type,
'Jumlah': amount,
'Saldo': newBalance
};
// Show loading
showLoading();
try {
// Add expense
const response = await fetchData('Pengeluaran', 'insert', expenseData);
if (response.success) {
// Reset form
document.getElementById('expense-type').value = 'Stok Air';
document.getElementById('expense-amount').value = '';
document.getElementById('expense-description').value = '';
// Close modal
closeModal('add-expense-modal');
// Add notification
addNotification('warning', `Pengeluaran berhasil ditambahkan! Jumlah: Rp ${amount.toLocaleString('id-ID')}`);
// Refresh data
await Promise.all([
loadExpenses(),
loadFinancialSummary()
]);
showToast('Pengeluaran berhasil ditambahkan', 'success');
// Reload page in background after adding expense
reloadPageInBackground();
} else {
showToast('Gagal menambah pengeluaran', 'error');
}
} catch (error) {
console.error(error);
showToast('Terjadi kesalahan saat menambah pengeluaran', 'error');
} finally {
hideLoading();
}
}
// Clear Local Storage
function clearLocalStorage() {
if (confirm('Apakah Anda yakin ingin menghapus semua data di local storage?')) {
localStorage.removeItem('kasirStokAirData');
localStorage.setItem('localStorageEnabled', 'false');
document.getElementById('local-storage-toggle').checked = false;
localStorageEnabled = false;
showToast('Data local storage berhasil dihapus', 'success');
// Reload page in background after clearing local storage
reloadPageInBackground();
}
}
// Save Settings
async function saveSettings() {
const businessName = document.getElementById('business-name-input').value;
const businessAddress = document.getElementById('business-address-input').value;
const businessContact = document.getElementById('business-contact-input').value;
const businessLogo = document.getElementById('business-logo-input').value;
const tankCapacity = document.getElementById('settings-tank-capacity').value;
const supplyCost = document.getElementById('settings-supply-cost').value;
const apiKey = document.getElementById('api-script-input').value;
// Validate logo URL if provided
if (businessLogo && businessLogo.trim() !== '') {
try {
new URL(businessLogo);
} catch (e) {
showToast('URL logo tidak valid', 'error');
return;
}
}
// Prepare settings data
const settingsData = {
'Nama Usaha': businessName,
'Alamat Usaha': businessAddress,
'Kontak': businessContact,
'Logo': businessLogo,
'Kapasitas Toren (Liter)': tankCapacity,
'Biaya Suplai Air Tangki (Rp)': supplyCost,
'API': apiKey
};
// Update API key if provided
if (apiKey) {
API_KEY = apiKey;
}
// Show loading
showLoading();
try {
// Update settings
const response = await fetchData('Pengaturan', 'update', {
row: 2,
...settingsData
});
if (response.success) {
// Update water stock capacity
await fetchData('Stok Air', 'update', {
row: 2,
'Kapasitas Toren': tankCapacity
});
// Save toast settings
const toastPosition = document.getElementById('toast-position').value;
const toastStyle = document.getElementById('toast-style').value;
// Update global toast settings
setToastPosition(toastPosition);
setToastStyle(toastStyle);
// Save to localStorage
localStorage.setItem('toastPosition', toastPosition);
localStorage.setItem('toastStyle', toastStyle);
// Refresh data
await Promise.all([
loadSettings(),
loadWaterStock()
]);
// Add notification
addNotification('success', 'Pengaturan berhasil disimpan');
showToast('Pengaturan berhasil disimpan', 'success');
// Reload page in background after saving settings
reloadPageInBackground();
} else {
showToast('Gagal menyimpan pengaturan', 'error');
}
} catch (error) {
console.error(error);
showToast('Terjadi kesalahan saat menyimpan pengaturan', 'error');
} finally {
hideLoading();
}
}
// Show Payment Debt Modal
function showPaymentDebtModal(transactionId) {
const transaction = transactions.find(t => t['ID Transaksi'] === transactionId);
if (!transaction) return;
currentDebtId = transactionId;
document.getElementById('debt-customer-name').value = transaction['Nama Pelanggan'];
document.getElementById('debt-amount').value = parseInt(transaction['Harga Jual (Rp)']);
document.getElementById('payment-amount').value = parseInt(transaction['Harga Jual (Rp)']);
// Calculate remaining debt
updateRemainingDebt();
document.getElementById('payment-debt-modal').classList.remove('hidden');
}
// Update Remaining Debt
function updateRemainingDebt() {
const debtAmount = parseInt(document.getElementById('debt-amount').value) || 0;
const paymentAmount = parseInt(document.getElementById('payment-amount').value) || 0;
const remainingDebt = Math.max(0, debtAmount - paymentAmount);
document.getElementById('remaining-debt').textContent = remainingDebt.toLocaleString('id-ID');
}
// Listen for payment amount changes
document.getElementById('payment-amount')?.addEventListener('input', updateRemainingDebt);
// Pay Debt
async function payDebt() {
if (!currentDebtId) return;
const paymentAmount = parseInt(document.getElementById('payment-amount').value) || 0;
const debtAmount = parseInt(document.getElementById('debt-amount').value) || 0;
if (paymentAmount <= 0) {
showToast('Jumlah pembayaran harus lebih dari 0', 'error');
return;
}
if (paymentAmount > debtAmount) {
showToast('Jumlah pembayaran melebihi hutang', 'error');
return;
}
// Find transaction
const transactionIndex = transactions.findIndex(t => t['ID Transaksi'] === currentDebtId);
if (transactionIndex === -1) return;
// Update transaction status
const status = paymentAmount === debtAmount ? 'Lunas' : 'Hutang';
// Show loading
showLoading();
try {
const response = await fetchData('Transaksi', 'update', {
row: transactionIndex + 2,
'Status': status
});
if (response.success) {
// Create a new transaction for the payment if partial payment
if (paymentAmount < debtAmount) {
const date = new Date();
const paymentTransactionId = `PAY-${date.getFullYear()}${(date.getMonth()+1).toString().padStart(2, '0')}${date.getDate().toString().padStart(2, '0')}-${Math.floor(Math.random() * 1000).toString().padStart(3, '0')}`;
const paymentData = {
'ID Transaksi': paymentTransactionId,
'Tanggal': date.toISOString(),
'Produk': 'Pembayaran Hutang',
'Jumlah': 1,
'Harga Jual (Rp)': paymentAmount,
'Harga Pokok (Rp)': 0,
'Laba Kotor (Rp)': paymentAmount,
'Nama Pelanggan': document.getElementById('debt-customer-name').value,
'Status': 'Lunas'
};
await fetchData('Transaksi', 'insert', paymentData);
}
// Close modal
closeModal('payment-debt-modal');
// Add notification
addNotification('success', `Pembayaran hutang sebesar Rp ${paymentAmount.toLocaleString('id-ID')} berhasil`);
// Refresh data
await Promise.all([
loadTransactions(),
loadDebts(),
loadFinancialSummary()
]);
showToast('Pembayaran berhasil', 'success');
// Reload page in background after paying debt
reloadPageInBackground();
} else {
showToast('Gagal memproses pembayaran', 'error');
}
} catch (error) {
console.error(error);
showToast('Terjadi kesalahan saat memproses pembayaran', 'error');
} finally {
hideLoading();
}
}
// Generate Report
async function generateReport() {
const period = document.getElementById('report-period').value;
let startDate, endDate;
const today = new Date();
switch (period) {
case 'today':
startDate = new Date(today.getFullYear(), today.getMonth(), today.getDate());
endDate = new Date(today.getFullYear(), today.getMonth(), today.getDate() + 1);
break;
case 'week':
const dayOfWeek = today.getDay();
startDate = new Date(today.getFullYear(), today.getMonth(), today.getDate() - dayOfWeek);
endDate = new Date(today.getFullYear(), today.getMonth(), today.getDate() - dayOfWeek + 7);
break;
case 'month':
startDate = new Date(today.getFullYear(), today.getMonth(), 1);
endDate = new Date(today.getFullYear(), today.getMonth() + 1, 1);
break;
case 'year':
startDate = new Date(today.getFullYear(), 0, 1);
endDate = new Date(today.getFullYear() + 1, 0, 1);
break;
}
// Filter transactions by period
const filteredTransactions = transactions.filter(t => {
const transactionDate = new Date(t['Tanggal']);
return transactionDate >= startDate && transactionDate < endDate;
});
// Calculate totals
const totalTransactions = filteredTransactions.length;
const totalIncome = filteredTransactions.reduce((sum, t) => sum + parseInt(t['Harga Jual (Rp)']), 0);
const totalDebts = filteredTransactions
.filter(t => t['Status'] === 'Hutang')
.reduce((sum, t) => sum + parseInt(t['Harga Jual (Rp)']), 0);
const totalProfit = filteredTransactions.reduce((sum, t) => sum + parseInt(t['Laba Kotor (Rp)']), 0);
// Update UI
document.getElementById('report-total-transactions').textContent = totalTransactions;
document.getElementById('report-total-income').textContent = totalIncome.toLocaleString('id-ID');
document.getElementById('report-total-debts').textContent = totalDebts.toLocaleString('id-ID');
document.getElementById('report-total-profit').textContent = totalProfit.toLocaleString('id-ID');
// Get top products
const productSales = {};
filteredTransactions.forEach(t => {
if (!productSales[t['Produk']]) {
productSales[t['Produk']] = 0;
}
productSales[t['Produk']] += parseInt(t['Jumlah']);
});
const topProducts = Object.entries(productSales)
.sort((a, b) => b[1] - a[1])
.slice(0, 5);
const topProductsContainer = document.getElementById('top-products');
if (topProductsContainer) {
topProductsContainer.innerHTML = '';
if (topProducts.length === 0) {
topProductsContainer.innerHTML = '<p class="text-gray-500 text-center py-2">Tidak ada data</p>';
} else {
topProducts.forEach(([product, quantity], index) => {
const productItem = document.createElement('div');
productItem.className = 'flex justify-between items-center py-1';
productItem.style.animationDelay = `${index * 0.05}s`;
productItem.style.animation = 'slideUp 0.3s ease-out forwards';
productItem.innerHTML = `
<span class="text-sm">${product}</span>
<span class="text-sm font-medium">${quantity} item</span>
`;
topProductsContainer.appendChild(productItem);
});
}
}
showToast('Laporan berhasil dibuat', 'success');
}
// Close Modal
function closeModal(modalId) {
document.getElementById(modalId).classList.add('hidden');
}
// Disable API Key Input
function disableApiKeyInput() {
const apiKeyInput = document.getElementById('api-script-input');
if (apiKeyInput && apiKeyInput.value.trim() !== '') {
apiKeyInput.disabled = true;
showToast('API key telah disimpan dan dikunci untuk keamanan', 'success');
}
}
// Reload Page in Background
function reloadPageInBackground() {
const reloadFrame = document.getElementById('reload-frame');
if (reloadFrame) {
// Add timestamp for cache busting
const timestamp = new Date().getTime();
reloadFrame.src = window.location.href + '?t=' + timestamp;
// Listen for load event to know when reload is complete
reloadFrame.onload = function() {
console.log('Background reload completed');
// Refresh critical data
refreshCriticalData();
};
}
}
// Refresh Critical Data
function refreshCriticalData() {
// Refresh only the most critical data
loadWaterStock();
loadFinancialSummary();
}
// Refresh All Data
async function refreshAllData() {
showLoading();
try {
// Refresh all data
await Promise.all([
loadSettings(),
loadProducts(),
loadCustomers(),
loadWaterStock(),
loadTransactions(),
loadExpenses(),
loadNotifications()
]);
showToast('Semua data berhasil diperbarui', 'success');
// Reload page in background after refreshing data
reloadPageInBackground();
} catch (error) {
showToast('Gagal memperbarui data', 'error');
console.error(error);
} finally {
hideLoading();
}
}
// Set Theme
function setTheme(theme) {
// Remove all theme classes
document.body.classList.remove('default-theme', 'dark-theme', 'light-theme');
// Add selected theme class
document.body.classList.add(`${theme}-theme`);
// Update theme selector UI
document.querySelectorAll('.theme-option').forEach(option => {
option.classList.remove('active');
});
document.querySelector(`.theme-${theme}`).classList.add('active');
// Save theme preference
localStorage.setItem('appTheme', theme);
currentTheme = theme;
// Apply theme-specific styles
applyThemeStyles(theme);
}
// Apply Theme-specific Styles
function applyThemeStyles(theme) {
// Theme-specific styles can be applied here if needed
// For now, CSS variables handle most of the theming
}
// Add event listeners for real-time updates
document.addEventListener('DOMContentLoaded', function() {
// Event listener for payment amount input to calculate change in real-time
const paymentAmountInput = document.getElementById('payment-amount');
if (paymentAmountInput) {
paymentAmountInput.addEventListener('input', updateChangeCalculation);
}
// Event listener for cart quantity changes
document.addEventListener('change', function(e) {
if (e.target.classList.contains('cart-quantity-input')) {
const index = parseInt(e.target.dataset.index);
const value = parseInt(e.target.value) || 1;
updateQuantity(index, value);
}
});
// Event listener for online/offline status
window.addEventListener('online', function() {
if (localStorageEnabled) {
showToast('Anda kembali online. Menyinkronkan data...', 'success');
// Refresh data from server
loadSettings()
.then(() => loadProducts())
.then(() => loadCustomers())
.then(() => loadWaterStock())
.then(() => loadTransactions())
.then(() => loadExpenses())
.then(() => loadNotifications())
.then(() => {
showToast('Data berhasil disinkronkan', 'success');
})
.catch(error => {
showToast('Gagal menyinkronkan data', 'error');
console.error(error);
});
}
});
window.addEventListener('offline', function() {
if (localStorageEnabled) {
showToast('Anda sedang offline. Menggunakan data tersimpan.', 'warning');
} else {
showToast('Anda sedang offline. Aktifkan Local Storage untuk akses offline.', 'error');
}
});
});
</script>
</body>
</html>
