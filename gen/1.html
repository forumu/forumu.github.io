<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Generator Prompt Apps Script</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
  <style>
    body {
      padding-top: env(safe-area-inset-top);
    }
  </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center justify-start p-6 overflow-auto">
  <div class="bg-white shadow-xl rounded-2xl p-6 w-full max-w-4xl ">
    <header class="flex items-center justify-between mb-6 sticky top-0 bg-white z-10 pt-4 pb-4 border-b border-gray-200">
      <div class="flex items-center space-x-4">
        <img id="headerLogo" src="https://forumu.github.io/gen/logo.png" alt="Logo default berwarna hijau dengan simbol aplikasi modern minimalis" class="w-12 h-12 object-contain rounded" />
        <input type="text" id="storeName" name="storeName" placeholder="Nama Toko" class="border border-gray-300 rounded p-2 w-48" />
      </div>
      <h1 id="sheetNameHeader" class="text-2xl font-bold">üìù Generator Prompt Apps Script</h1>
    </header>

    <form id="promptForm" class="space-y-6" autocomplete="off">
      <div>
        <label class="block font-semibold mb-1" for="logoUrl">URL Logo (opsional, akan menjadi favicon dan logo header)</label>
        <input type="url" id="logoUrl" name="logoUrl" placeholder="https://example.com/logo.png" class="w-full border p-2 rounded" />
      </div>

      <div>
        <label class="block font-semibold mb-1" for="storeNameInput">Nama Toko (akan tampil di header dan prompt)</label>
        <input type="text" id="storeNameInput" name="storeNameInput" placeholder="Nama Toko" class="w-full border p-2 rounded" />
      </div>

      <div>
        <label class="block font-semibold mb-1" for="sheet">Nama Sheet</label>
        <input type="text" id="sheet" name="sheet" placeholder="Produk" class="w-full border p-2 rounded" required />
      </div>

      <div>
        <label class="block font-semibold mb-1" for="columns">Kolom (pisahkan dengan koma)</label>
        <input type="text" id="columns" name="columns" placeholder="ProdukID, ProdukNama, ProdukHarga" class="w-full border p-2 rounded" required />
      </div>

      <div>
        <label class="block font-semibold mb-1" for="idColumn">Kolom ID</label>
        <input type="text" id="idColumn" name="idColumn" placeholder="ProdukID" class="w-full border p-2 rounded" required />
      </div>

      <div>
        <label class="block font-semibold mb-1" for="cssFramework">Framework CSS</label>
        <select id="cssFramework" name="cssFramework" class="w-full border p-2 rounded" required>
          <option value="TailwindCSS">TailwindCSS</option>
          <option value="Bootstrap">Bootstrap</option>
        </select>
      </div>

      <div>
        <label class="block font-semibold mb-1" for="apiUrl">API</label>
        <input type="text" id="apiUrl" name="apiUrl" placeholder="AKfycby_6VvnaHFQ4hmJALaX5-Zk1bF-nHzyuGR_FfdDvtJfbu_YMWLsVycoCrtCT-DlyMAv" class="w-full border p-2 rounded" required />
      </div>

      <div>
        <label class="block font-semibold mb-1" for="spreadsheetUrl">Spreadsheet URL</label>
        <input type="url" id="spreadsheetUrl" name="spreadsheetUrl" placeholder="https://docs.google.com/spreadsheets/d/..." class="w-full border p-2 rounded" required />
      </div>

      <div class="flex items-center space-x-3">
        <input type="checkbox" id="customColorsToggle" name="customColorsToggle" />
        <label for="customColorsToggle" class="font-semibold cursor-pointer select-none">Gunakan Palet Warna Kustom</label>
      </div>

      <div id="customColorsContainer" class="space-y-4 mt-2 hidden">
        <div>
          <label class="block font-semibold mb-1" for="colorPrimary">Warna Utama (teal-800) - untuk tombol, link, icon utama</label>
          <input type="color" id="colorPrimary" name="colorPrimary" value="#0f766e" class="w-20 h-10 p-0 border rounded cursor-pointer" />
        </div>

        <div>
          <label class="block font-semibold mb-1" for="colorSecondary">Warna Sekunder (#000) - untuk teks utama dan ikon sekunder</label>
          <input type="color" id="colorSecondary" name="colorSecondary" value="#000000" class="w-20 h-10 p-0 border rounded cursor-pointer" />
        </div>

        <div>
          <label class="block font-semibold mb-1" for="colorGradientStart">Warna Gradiasi Awal - untuk elemen gradiasi utama</label>
          <input type="color" id="colorGradientStart" name="colorGradientStart" value="#0f766e" class="w-20 h-10 p-0 border rounded cursor-pointer" />
        </div>

        <div>
          <label class="block font-semibold mb-1" for="colorGradientEnd">Warna Gradiasi Akhir - untuk elemen gradiasi utama</label>
          <input type="color" id="colorGradientEnd" name="colorGradientEnd" value="#000000" class="w-20 h-10 p-0 border rounded cursor-pointer" />
        </div>

        <div>
          <label class="block font-semibold mb-1" for="colorBgGradientStart">Warna Gradiasi Background Header & Menu Awal - untuk latar header dan navigasi bawah</label>
          <input type="color" id="colorBgGradientStart" name="colorBgGradientStart" value="#0f766e" class="w-20 h-10 p-0 border rounded cursor-pointer" />
        </div>

        <div>
          <label class="block font-semibold mb-1" for="colorBgGradientEnd">Warna Gradiasi Background Header & Menu Akhir - untuk latar header dan navigasi bawah</label>
          <input type="color" id="colorBgGradientEnd" name="colorBgGradientEnd" value="#000000" class="w-20 h-10 p-0 border rounded cursor-pointer" />
        </div>
      </div>

      <div class="flex items-center space-x-3">
        <input type="checkbox" id="fillCodeGs" checked />
        <label for="fillCodeGs" class="font-semibold cursor-pointer select-none">Isi otomatis Code.gs dengan template standar</label>
      </div>

      <div id="codeGsContainer">
        <label class="block font-semibold mb-1" for="codeGs">Code.gs</label>
        <textarea id="codeGs" name="codeGs" rows="12" placeholder="Paste code.gs di sini" class="w-full border p-2 rounded font-mono"></textarea>
      </div>

      <div>
        <label class="block font-semibold mb-2">Menu dan Link (tambahkan menu baru dengan tombol +)</label>
        <div id="menuList" class="space-y-4 max-h-72 overflow-y-auto">
          <div class="flex flex-col md:flex-row md:space-x-4 space-y-2 md:space-y-0 items-center border rounded p-3">
            <input type="text" name="menuName[]" placeholder="Beranda" class="flex-1 border p-2 rounded" required />
            <input type="text" name="menuLink[]" placeholder="/" class="flex-1 border p-2 rounded" required />
            <button type="button" class="text-red-600 hover:text-red-800" aria-label="Hapus menu" onclick="removeMenu(this)">
              <i class="fas fa-trash-alt fa-lg"></i>
            </button>
          </div>
          <div class="flex flex-col md:flex-row md:space-x-4 space-y-2 md:space-y-0 items-center border rounded p-3">
            <input type="text" name="menuName[]" placeholder="Produk" class="flex-1 border p-2 rounded" required />
            <input type="text" name="menuLink[]" placeholder="?Produk" class="flex-1 border p-2 rounded" required />
            <button type="button" class="text-red-600 hover:text-red-800" aria-label="Hapus menu" onclick="removeMenu(this)">
              <i class="fas fa-trash-alt fa-lg"></i>
            </button>
          </div>
          <div class="flex flex-col md:flex-row md:space-x-4 space-y-2 md:space-y-0 items-center border rounded p-3">
            <input type="text" name="menuName[]" placeholder="Penjualan" class="flex-1 border p-2 rounded" required />
            <input type="text" name="menuLink[]" placeholder="?Penjualan" class="flex-1 border p-2 rounded" required />
            <button type="button" class="text-red-600 hover:text-red-800" aria-label="Hapus menu" onclick="removeMenu(this)">
              <i class="fas fa-trash-alt fa-lg"></i>
            </button>
          </div>
          <div class="flex flex-col md:flex-row md:space-x-4 space-y-2 md:space-y-0 items-center border rounded p-3">
            <input type="text" name="menuName[]" placeholder="Keuangan" class="flex-1 border p-2 rounded" required />
            <input type="text" name="menuLink[]" placeholder="?Keuangan" class="flex-1 border p-2 rounded" required />
            <button type="button" class="text-red-600 hover:text-red-800" aria-label="Hapus menu" onclick="removeMenu(this)">
              <i class="fas fa-trash-alt fa-lg"></i>
            </button>
          </div>
          <div class="flex flex-col md:flex-row md:space-x-4 space-y-2 md:space-y-0 items-center border rounded p-3">
            <input type="text" name="menuName[]" placeholder="Lainnya" class="flex-1 border p-2 rounded" required />
            <input type="text" name="menuLink[]" placeholder="?Lainnya" class="flex-1 border p-2 rounded" required />
            <button type="button" class="text-red-600 hover:text-red-800" aria-label="Hapus menu" onclick="removeMenu(this)">
              <i class="fas fa-trash-alt fa-lg"></i>
            </button>
          </div>
        </div>
        <button type="button" id="addMenuBtn" class="mt-3 bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 flex items-center justify-center gap-2 w-full md:w-auto">
          <i class="fas fa-plus"></i> Tambah Menu
        </button>
      </div>

      <button type="button" onclick="generatePrompt()" class="bg-blue-600 text-white px-6 py-3 rounded hover:bg-blue-700 w-full text-lg font-semibold flex items-center justify-center gap-2">
        <i class="fas fa-rocket"></i> Generate Prompt
      </button>
    </form>
  </div>

  <!-- Popup Overlay -->
  <div id="popupOverlay" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-lg shadow-lg max-w-3xl w-full mx-4 p-6 relative">
      <button id="popupCloseBtn" aria-label="Close popup" class="absolute top-3 right-3 text-gray-600 hover:text-gray-900 text-xl font-bold">&times;</button>
      <h2 class="text-xl font-bold mb-3 flex items-center gap-2"><i class="fas fa-thumbtack"></i> Hasil Prompt</h2>
      <textarea id="result" rows="20" class="w-full border p-3 rounded font-mono text-sm md:text-base" readonly></textarea>
      <button id="copyBtn" class="mt-3 bg-green-600 text-white px-5 py-2 rounded hover:bg-green-700 w-full md:w-auto flex items-center justify-center gap-2">
        <i class="fas fa-clipboard"></i> Copy
      </button>
    </div>
  </div>

  <script>
    const addMenuBtn = document.getElementById("addMenuBtn");
    const menuList = document.getElementById("menuList");
    const form = document.getElementById("promptForm");
    const fillCodeGsCheckbox = document.getElementById("fillCodeGs");
    const codeGsTextarea = document.getElementById("codeGs");
    const codeGsContainer = document.getElementById("codeGsContainer");
    const logoUrlInput = document.getElementById("logoUrl");
    const headerLogo = document.getElementById("headerLogo");
    const storeNameInputHeader = document.getElementById("storeName");
    const storeNameInputForm = document.getElementById("storeNameInput");
    const sheetNameHeader = document.getElementById("sheetNameHeader");

    const customColorsToggle = document.getElementById("customColorsToggle");
    const customColorsContainer = document.getElementById("customColorsContainer");

    const colorPrimaryInput = document.getElementById("colorPrimary");
    const colorSecondaryInput = document.getElementById("colorSecondary");
    const colorGradientStartInput = document.getElementById("colorGradientStart");
    const colorGradientEndInput = document.getElementById("colorGradientEnd");
    const colorBgGradientStartInput = document.getElementById("colorBgGradientStart");
    const colorBgGradientEndInput = document.getElementById("colorBgGradientEnd");

    const popupOverlay = document.getElementById("popupOverlay");
    const resultTextarea = document.getElementById("result");
    const copyBtn = document.getElementById("copyBtn");
    const popupCloseBtn = document.getElementById("popupCloseBtn");

    const defaultLogoUrl = "https://forumu.github.io/gen/logo.png";

    const defaultColors = {
      colorPrimary: "#0f766e",
      colorSecondary: "#000000",
      colorGradientStart: "#0f766e",
      colorGradientEnd: "#000000",
      colorBgGradientStart: "#0f766e",
      colorBgGradientEnd: "#000000"
    };

    const defaultCodeGs = `// Fungsi utama untuk menangani permintaan HTTP GET
function doGet(e) {
  const sheetName = e.parameter.sheet;
  if (!sheetName) {
    return responseJson(false, "Parameter 'sheet' tidak ditemukan", null);
  }

  const sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName(sheetName);
  if (!sheet) {
    return responseJson(false, \`Sheet '\${sheetName}' tidak ditemukan\`, null);
  }

  const action = e.parameter.action;
  let response;

  if (action === "get-data") {
    response = getDatas(sheet);
  } else if (action === "insert") {
    response = addData(sheet, e.parameter);
  } else if (action === "update") {
    const row = parseInt(e.parameter.row);
    response = updateData(sheet, row, e.parameter);
  } else if (action === "delete") {
    const row = parseInt(e.parameter.row);
    response = deleteData(sheet, row);
  } else {
    response = responseJson(false, "Action tidak dikenali", null);
  }

  return ContentService.createTextOutput(JSON.stringify(response)).setMimeType(ContentService.MimeType.JSON);
}

// Fungsi untuk mengubah respons menjadi JSON
function responseJson(success, message, data) {
  return { success, message, data };
}

// Fungsi untuk mendapatkan data dari sheet secara otomatis berdasarkan header
function getDatas(sheet) {
  const data = sheet.getDataRange().getValues();
  if (data.length < 2) {
    return responseJson(false, "Tidak ada data", null);
  }

  const headers = data[0]; // Header di baris pertama
  const jsonData = data.slice(1).map(row => {
    let obj = {};
    headers.forEach((header, index) => {
      obj[header] = row[index];
    });
    return obj;
  });

  return responseJson(true, "Sukses menampilkan data", jsonData);
}

// Fungsi untuk menambahkan data berdasarkan header tanpa menyebutkan nama kolom
function addData(sheet, params) {
  const headers = sheet.getDataRange().getValues()[0];
  const newRow = headers.map(header => params[header] || ""); // Ambil nilai dari parameter sesuai header

  sheet.appendRow(newRow);
  return responseJson(true, "Sukses menyimpan data", newRow);
}

// Fungsi untuk memperbarui data di sheet berdasarkan header
function updateData(sheet, row, params) {
  if (row < 2) {
    return responseJson(false, "Baris tidak valid", null);
  }

  const headers = sheet.getDataRange().getValues()[0];
  headers.forEach((header, index) => {
    if (params[header] !== undefined) {
      sheet.getRange(row, index + 1).setValue(params[header]);
    }
  });

  return responseJson(true, "Sukses mengubah data", { row, ...params });
}

// Fungsi untuk menghapus data dari sheet
function deleteData(sheet, row) {
  if (row < 2) {
    return responseJson(false, "Baris tidak valid", null);
  }
  sheet.deleteRow(row);
  return responseJson(true, "Sukses menghapus data", { row });
}`;

    // Load saved data from localStorage on page load
    window.addEventListener("DOMContentLoaded", () => {
      const savedData = localStorage.getItem("generatorData");
      if (savedData) {
        try {
          const data = JSON.parse(savedData);

          if (data.logoUrl && data.logoUrl.trim() !== "") {
            logoUrlInput.value = data.logoUrl;
            headerLogo.src = data.logoUrl;
          } else {
            logoUrlInput.value = "";
            headerLogo.src = defaultLogoUrl;
          }

          if (data.storeNameInput) {
            storeNameInputForm.value = data.storeNameInput;
            storeNameInputHeader.value = data.storeNameInput;
          } else {
            storeNameInputForm.value = "";
            storeNameInputHeader.value = "";
          }

          if (data.sheet) {
            form.sheet.value = data.sheet;
            sheetNameHeader.textContent = data.sheet;
          } else {
            sheetNameHeader.textContent = "üìù Generator Prompt Apps Script";
          }

          if (data.columns) form.columns.value = data.columns;
          if (data.idColumn) form.idColumn.value = data.idColumn;
          if (data.cssFramework) form.cssFramework.value = data.cssFramework;
          if (data.apiUrl) form.apiUrl.value = data.apiUrl;
          if (data.spreadsheetUrl) form.spreadsheetUrl.value = data.spreadsheetUrl;

          if (data.customColorsToggle) {
            customColorsToggle.checked = true;
            customColorsContainer.classList.remove("hidden");
          } else {
            customColorsToggle.checked = false;
            customColorsContainer.classList.add("hidden");
          }

          colorPrimaryInput.value = data.colorPrimary || defaultColors.colorPrimary;
          colorSecondaryInput.value = data.colorSecondary || defaultColors.colorSecondary;
          colorGradientStartInput.value = data.colorGradientStart || defaultColors.colorGradientStart;
          colorGradientEndInput.value = data.colorGradientEnd || defaultColors.colorGradientEnd;
          colorBgGradientStartInput.value = data.colorBgGradientStart || defaultColors.colorBgGradientStart;
          colorBgGradientEndInput.value = data.colorBgGradientEnd || defaultColors.colorBgGradientEnd;

          if (data.codeGs) {
            codeGsTextarea.value = data.codeGs;
            fillCodeGsCheckbox.checked = (data.codeGs.trim() === defaultCodeGs.trim());
          } else {
            fillCodeGsCheckbox.checked = true;
          }
          updateCodeGsVisibility();

          if (Array.isArray(data.menuName) && Array.isArray(data.menuLink)) {
            // Clear existing menus
            menuList.innerHTML = "";
            for (let i = 0; i < data.menuName.length; i++) {
              addMenuItem(data.menuName[i], data.menuLink[i]);
            }
          }
        } catch {
          // ignore JSON parse errors
          fillCodeGsCheckbox.checked = true;
          updateCodeGsVisibility();
          customColorsToggle.checked = false;
          customColorsContainer.classList.add("hidden");
          colorPrimaryInput.value = defaultColors.colorPrimary;
          colorSecondaryInput.value = defaultColors.colorSecondary;
          colorGradientStartInput.value = defaultColors.colorGradientStart;
          colorGradientEndInput.value = defaultColors.colorGradientEnd;
          colorBgGradientStartInput.value = defaultColors.colorBgGradientStart;
          colorBgGradientEndInput.value = defaultColors.colorBgGradientEnd;
          storeNameInputForm.value = "";
          storeNameInputHeader.value = "";
          sheetNameHeader.textContent = "üìù Generator Prompt Apps Script";
        }
      } else {
        // Default state: checkbox checked and textarea hidden, no custom colors
        fillCodeGsCheckbox.checked = true;
        updateCodeGsVisibility();
        customColorsToggle.checked = false;
        customColorsContainer.classList.add("hidden");
        colorPrimaryInput.value = defaultColors.colorPrimary;
        colorSecondaryInput.value = defaultColors.colorSecondary;
        colorGradientStartInput.value = defaultColors.colorGradientStart;
        colorGradientEndInput.value = defaultColors.colorGradientEnd;
        colorBgGradientStartInput.value = defaultColors.colorBgGradientStart;
        colorBgGradientEndInput.value = defaultColors.colorBgGradientEnd;
        storeNameInputForm.value = "";
        storeNameInputHeader.value = "";
        sheetNameHeader.textContent = "üìù Generator Prompt Apps Script";
      }
    });

    // Sync store name input in form and header
    storeNameInputForm.addEventListener("input", () => {
      storeNameInputHeader.value = storeNameInputForm.value;
      saveFormData();
    });

    // Sync header store name input back to form (optional)
    storeNameInputHeader.addEventListener("input", () => {
      storeNameInputForm.value = storeNameInputHeader.value;
      saveFormData();
    });

    // Sync sheet name input to header title
    form.sheet.addEventListener("input", () => {
      sheetNameHeader.textContent = form.sheet.value || "üìù Generator Prompt Apps Script";
      saveFormData();
    });

    // Toggle custom colors container visibility
    customColorsToggle.addEventListener("change", () => {
      if (customColorsToggle.checked) {
        customColorsContainer.classList.remove("hidden");
      } else {
        customColorsContainer.classList.add("hidden");
        // Reset colors to default when unchecked
        colorPrimaryInput.value = defaultColors.colorPrimary;
        colorSecondaryInput.value = defaultColors.colorSecondary;
        colorGradientStartInput.value = defaultColors.colorGradientStart;
        colorGradientEndInput.value = defaultColors.colorGradientEnd;
        colorBgGradientStartInput.value = defaultColors.colorBgGradientStart;
        colorBgGradientEndInput.value = defaultColors.colorBgGradientEnd;
      }
      saveFormData();
    });

    // Save form data to localStorage on input change
    form.addEventListener("input", () => {
      // Update header logo src live when logoUrl input changes
      if (logoUrlInput.value.trim() !== "") {
        headerLogo.src = logoUrlInput.value.trim();
      } else {
        headerLogo.src = defaultLogoUrl;
      }
      saveFormData();
    });

    // Checkbox to fill code.gs with default code or clear it and toggle textarea visibility
    fillCodeGsCheckbox.addEventListener("change", () => {
      if (fillCodeGsCheckbox.checked) {
        codeGsTextarea.value = defaultCodeGs;
      } else {
        codeGsTextarea.value = "";
      }
      updateCodeGsVisibility();
      saveFormData();
    });

    function updateCodeGsVisibility() {
      if (fillCodeGsCheckbox.checked) {
        codeGsContainer.style.display = "none";
      } else {
        codeGsContainer.style.display = "block";
      }
    }

    function saveFormData() {
      const formData = new FormData(form);
      const data = {
        logoUrl: formData.get("logoUrl") || "",
        storeNameInput: storeNameInputForm.value || "",
        sheet: formData.get("sheet") || "",
        columns: formData.get("columns") || "",
        idColumn: formData.get("idColumn") || "",
        cssFramework: formData.get("cssFramework") || "",
        apiUrl: formData.get("apiUrl") || "",
        spreadsheetUrl: formData.get("spreadsheetUrl") || "",
        customColorsToggle: customColorsToggle.checked,
        colorPrimary: formData.get("colorPrimary") || defaultColors.colorPrimary,
        colorSecondary: formData.get("colorSecondary") || defaultColors.colorSecondary,
        colorGradientStart: formData.get("colorGradientStart") || defaultColors.colorGradientStart,
        colorGradientEnd: formData.get("colorGradientEnd") || defaultColors.colorGradientEnd,
        colorBgGradientStart: formData.get("colorBgGradientStart") || defaultColors.colorBgGradientStart,
        colorBgGradientEnd: formData.get("colorBgGradientEnd") || defaultColors.colorBgGradientEnd,
        codeGs: formData.get("codeGs") || "",
        menuName: formData.getAll("menuName[]"),
        menuLink: formData.getAll("menuLink[]"),
      };
      localStorage.setItem("generatorData", JSON.stringify(data));
    }

    addMenuBtn.addEventListener("click", () => {
      addMenuItem("", "");
      saveFormData();
    });

    function addMenuItem(name, link) {
      const menuItem = document.createElement("div");
      menuItem.className = "flex flex-col md:flex-row md:space-x-4 space-y-2 md:space-y-0 items-center border rounded p-3";

      const inputName = document.createElement("input");
      inputName.type = "text";
      inputName.name = "menuName[]";
      inputName.placeholder = "Nama Menu";
      inputName.required = true;
      inputName.className = "flex-1 border p-2 rounded";
      inputName.value = name;
      inputName.addEventListener("input", saveFormData);

      const inputLink = document.createElement("input");
      inputLink.type = "text";
      inputLink.name = "menuLink[]";
      inputLink.placeholder = "Link Menu";
      inputLink.required = true;
      inputLink.className = "flex-1 border p-2 rounded";
      inputLink.value = link;
      inputLink.addEventListener("input", saveFormData);

      const removeBtn = document.createElement("button");
      removeBtn.type = "button";
      removeBtn.className = "text-red-600 hover:text-red-800";
      removeBtn.setAttribute("aria-label", "Hapus menu");
      removeBtn.innerHTML = '<i class="fas fa-trash-alt fa-lg"></i>';
      removeBtn.onclick = () => {
        removeMenu(removeBtn);
        saveFormData();
      };

      menuItem.appendChild(inputName);
      menuItem.appendChild(inputLink);
      menuItem.appendChild(removeBtn);

      menuList.appendChild(menuItem);
    }

    function removeMenu(button) {
      const parent = button.parentElement;
      if (menuList.children.length > 1) {
        parent.remove();
      } else {
        alert("Minimal harus ada satu menu.");
      }
    }

    function generatePrompt() {
      const formData = new FormData(form);
      const data = Object.fromEntries(formData.entries());

      // Collect all menu names and links
      const menuNames = formData.getAll("menuName[]");
      const menuLinks = formData.getAll("menuLink[]");

      // Determine logo URL for prompt (use default if empty)
      const logoUrlForPrompt = data.logoUrl && data.logoUrl.trim() !== "" ? data.logoUrl.trim() : defaultLogoUrl;

      // Determine store name for prompt
      const storeNameForPrompt = data.storeNameInput && data.storeNameInput.trim() !== "" ? data.storeNameInput.trim() : "";

      // Determine sheet name for prompt
      const sheetNameForPrompt = data.sheet && data.sheet.trim() !== "" ? data.sheet.trim() : "";

      // Build menu string for prompt
      let menuString = "";
      for (let i = 0; i < menuNames.length; i++) {
        menuString += `- ${menuNames[i]} (link: ${menuLinks[i]})\n`;
      }

      // Build full API URL from ID for example usage
      const apiId = data.apiUrl ? data.apiUrl.trim() : "";
      const fullApiUrl = apiId ? `https://script.google.com/macros/s/${apiId}/exec` : "";

      // Use default colors if customColorsToggle is not checked
      const useCustomColors = customColorsToggle.checked;

      const colorPrimary = useCustomColors ? (data.colorPrimary || defaultColors.colorPrimary) : defaultColors.colorPrimary;
      const colorSecondary = useCustomColors ? (data.colorSecondary || defaultColors.colorSecondary) : defaultColors.colorSecondary;
      const colorGradientStart = useCustomColors ? (data.colorGradientStart || defaultColors.colorGradientStart) : defaultColors.colorGradientStart;
      const colorGradientEnd = useCustomColors ? (data.colorGradientEnd || defaultColors.colorGradientEnd) : defaultColors.colorGradientEnd;
      const colorBgGradientStart = useCustomColors ? (data.colorBgGradientStart || defaultColors.colorBgGradientStart) : defaultColors.colorBgGradientStart;
      const colorBgGradientEnd = useCustomColors ? (data.colorBgGradientEnd || defaultColors.colorBgGradientEnd) : defaultColors.colorBgGradientEnd;

      const prompt = `
Saya mempunyai Google Apps Script dengan code.gs yang sudah fleksibel untuk membaca header sheet secara otomatis. 
Saya ingin membuat form HTML untuk menambah dan mengedit data di sheet "${sheetNameForPrompt}" 
yang memiliki kolom: ${data.columns}.

Berikut adalah code.gs yang saya miliki:

\`\`\`javascript
${data.codeGs}
\`\`\`

Saya membutuhkan file HTML yang:

- Dapat digunakan untuk menambah dan mengedit data
- Menggunakan ${data.cssFramework} untuk tampilan yang responsif
- Memiliki validasi form
- Dapat berkomunikasi dengan code.gs yang sudah ada
- Untuk mode edit, form harus bisa mengambil data berdasarkan parameter ID di URL
- Menampilkan indikator loading saat menyimpan data
- Menampilkan pesan sukses/error setelah proses simpan
- URL API yang digunakan: ${fullApiUrl}
- Spreadsheet yang digunakan: ${data.spreadsheetUrl}

Contoh penggunaan:

- Tambah data: ${fullApiUrl}
- Edit data (misal ID=1): ${fullApiUrl}?id=1

Pastikan form HTML yang dihasilkan kompatibel dengan code.gs yang sudah ada tanpa perlu modifikasi code.gs.

Tampilan awal menampilkan list data (tidak boleh dalam tabel gunakan div, ul, li, span, atau lainnya). 
Lalu jika ingin menambah data tinggal tekan icon plus saja, untuk edit data tinggal tekan icon pensil di tiap tiap item yang mau di edit. 
Untuk ${data.idColumn} dibuat otomatis misal P001 dan seterusnya. 
Gunakan ${data.cssFramework} bukan framework lain. Tampilan aplikasi mobile dengan tampilan menarik moderen dan kekinian dengan Fitur yang harus ada:
- Header berisi nama toko "${storeNameForPrompt}" dan sheet "${sheetNameForPrompt}".
- Logo yang digunakan: ${logoUrlForPrompt} (juga sebagai favicon).
- Bottom navigation dengan menu sebagai berikut:
${menuString.trim()}
- Desain modern, minimalis, menggunakan warna utama ${colorPrimary} (untuk tombol, link, icon utama), ${colorSecondary} (untuk teks utama dan ikon sekunder), dan gradiasi dari ${colorGradientStart} ke ${colorGradientEnd} (untuk elemen gradiasi utama).
- Background gradiasi untuk header dan menu navigasi bawah dari ${colorBgGradientStart} ke ${colorBgGradientEnd} (untuk latar header dan navigasi bawah).
      `;

      resultTextarea.value = prompt.trim();
      popupOverlay.classList.remove("hidden");
      resultTextarea.focus();
      resultTextarea.select();
    }

    function copyPrompt() {
      navigator.clipboard.writeText(resultTextarea.value).then(() => {
        alert("Prompt berhasil dicopy ‚úÖ");
      }, () => {
        alert("Gagal menyalin prompt.");
      });
    }

    copyBtn.addEventListener("click", copyPrompt);
    popupCloseBtn.addEventListener("click", () => {
      popupOverlay.classList.add("hidden");
    });

    // Close popup on clicking outside content
    popupOverlay.addEventListener("click", (e) => {
      if (e.target === popupOverlay) {
        popupOverlay.classList.add("hidden");
      }
    });
  </script>
</body>
</html>
